// Dictionnaire de traductions (DARIJA UNIQUEMENT)
const translations = {
    'darija': {
        'subtitle': 'المساعدة الشخصية ديالك باش تتعلم الخياطة',
        'phone_label': 'رقم التيليفون',
        'password_label': 'كلمة السر',
        'phone_placeholder': 'مثال: 0612345678',
        'password_placeholder': 'دخل كلمة السر ديالك',
        'login_btn': 'دخول',
        'not_registered': 'ماسجلتيش بعد؟',
        'create_account': 'دير حساب جديد',
        'already_registered': 'عندك حساب؟',
        'sign_in': 'دخول',
        'create_account_btn': 'دير حساب جديد',
        'create_subtitle': 'دير الحساب ديالك باش تبدا تتعلم',
        'edit_profile': 'بدل المعلومات ديالك',
        'completed_courses': 'الدروس اللي كملتي',
        'my_progress': 'التقدم ديالي',
        'logout': 'خروج',
        'level_beginner': 'مستوى مبتدئ',
        'level_intermediate': 'مستوى متوسط',
        'level_advanced': 'مستوى متقدم',
        'change_photo': 'بدل الصورة',
        'username_label': 'الاسم ديالك',
        'username_placeholder': 'كتب الاسم ديالك',
        'cancel': 'إلغاء',
        'save': 'حفظ',
        'general_progress': 'التقدم العام',
        'your_progress': 'التقدم ديالك:',
        'quiz_passed': 'الاختبارات اللي نجحتي فيها',
        'average_score': 'المعدل ديالك (%)',
        'lessons_completed': 'الدروس اللي كملتي',
        'current_level': 'المستوى ديالك دابا',
        'member_since': 'عضو من',
        'completed_count': 'كملتي',
        'lessons_out_of': 'درس من 15',
        'no_lessons_completed': 'ماكملتيش أي درس بعد.',
        'confirm_logout': 'تأكيد الخروج',
        'logout_question': 'واش متأكد بلي بغيت تخرج؟',
        'message_placeholder': 'كتب الرسالة ديالك هنا...',
        'welcome_message': 'مرحبا بك {name} في Sena3timate!',
        'welcome_description': 'أنا المساعدة الشخصية ديالك باش تتعلم الخياطة. أنا هنا باش نعاونك في التعلم ونجاوب على الأسئلة ديالك ونوجهك خطوة بخطوة.',
        'see_modules': '📁 شوف الوحدات',
        'take_quiz': '🎯 دير اختبار',
        'see_glossary': '📖 شوف القاموس',
        'see_resources': '📀 شوف الموارد',
        'modules_title': 'وحدات التكوين',
        'test_knowledge': 'اختبر معلوماتك',
        'sewing_glossary': 'قاموس الخياطة',
        'additional_resources': 'موارد إضافية',
        'how_to_use': 'كيفاش تستعمل Sena3timate',
        'navigation': 'التنقل',
        'learning': 'التعلم',
        'customization': 'التخصيص',
        'tips': 'نصائح',
        'phone_exists': 'هاد الرقم مستعمل من قبل',
        'account_created': 'تم إنشاء الحساب بنجاح! يمكنك دابا تدخل.',
        'login_success': 'دخلتي بنجاح! أهلا وسهلا',
        'login_error': 'رقم التيليفون أو كلمة السر غالطة',
        'fill_fields': 'عمر جميع الحقول',
        'profile_updated': 'تم تحديث المعلومات!',
        'profile_saved': 'المعلومات ديالك تحفظو بنجاح.',
        'goodbye': 'بسلامة {name}!',
        'thanks_message': 'شكرا على استعمال Sena3timate. نشوفك قريبا باش نكملو التعلم!',
        'no_understand': 'مافهمتش شنو كتقصد، {name}. هاشنو يمكنني نقترح عليك:',
        'help_question': '❓ مساعدة',
        'copyright': '© 2025 Sena3timate – منصة تعلم الخياطة مخصصة للنساء الحرفيات.',
        'mission': 'مع بعض، نخيطو مستقبل أعدل، أحر، أكرم.',
        'main_menu': 'القائمة الرئيسية',
        'back_to_modules': 'رجوع للوحدات',
        'module_quiz': 'اختبار هاد الوحدة',
        'lesson_quiz': 'اختبار هاد الدرس',
        'next_lesson': 'الدرس اللي جاي',
        'back_to_module': 'رجوع للوحدة',
        'read_lesson': 'قرا الدرس',
        'video': 'فيديو',
        'next_question': 'السؤال اللي جاي',
        'restart_quiz': 'عاود الاختبار',
        'validate_answer': 'تأكيد الجواب',
        'quiz_question': 'سؤال الاختبار',
        'excellent_answer': 'جواب ممتاز!',
        'almost': 'قريب!',
        'explanation': 'الشرح:',
        'congratulations_module': 'مبروك! كملتي هاد الوحدة.',
        'choose_quiz': 'اختار اختبار باش تشوف مستواك:',
        'available_questions': 'أسئلة متوفرة',
        'my_results': 'النتائج ديالي',
        'no_results': 'ماكاينش نتائج',
        'no_quiz_yet': 'ماديتيش أي اختبار بعد. ابدا دابا!',
        'do_quiz': 'دير اختبار',
        'your_results': 'النتائج ديالك',
        'quiz_attempted': 'اختبارات جربتيها',
        'quiz_passed_results': 'اختبارات نجحتي فيها',
        'average_score_results': 'المعدل ديالك',
        'new_quiz': 'دير اختبار جديد',
        'view_progress': 'شوف التقدم ديالي',
        'all_definitions': 'لقا جميع تعاريف المصطلحات التقنية ديال الخياطة:',
        'search_term': 'دور على كلمة',
        'see_all_glossary': 'شوف كامل القاموس',
        'found_terms': 'الكلمات اللي لقيناها',
        'example': 'مثال:',
        'type_search': 'اكتب الكلمة اللي كتدور عليها في الدردشة!',
        'additional_resources_desc': 'اكتشف موارد إضافية باش تعمق معرفتك:',
        'consult': 'شوف',
        'resource_new_tab': 'هاد المصدر غادي يتفتح في تبويب جديد.',
        'access_resource': 'دخول للمصدر',
        'use_buttons': 'استعمل الأزرار المقترحة أو اكتب أسئلتك مباشرة. نافهم الكلمات مثل "وحدة"، "اختبار"، "قاموس"، "حساب"، إلخ.',
        'start_modules': 'ابدا بالوحدات باش تتعلم، وبعدها اختبر معلوماتك بالاختبارات. راجع القاموس إذا عندك شك في كلمة.',
        'click_profile': 'اضغط على الحساب ديالك فوق على اليمين باش تخصص الاسم والصورة ديالك.',
        'tip_1': 'اتبع الوحدات بالترتيب باش يكون التقدم ديالك مزيان',
        'tip_2': 'ماتترددش تعاود الاختبارات باش تحفظ مزيان',
        'tip_3': 'شوف الفيديوهات باش تتفرج على التقنيات بالعمل',
        'tip_4': 'استعمل القاموس كمرجع فالمشاريع ديالك',
        'tip_5': 'خصص الحساب ديالك باش يكون عندك تجربة أحسن',
        'start_learning': 'ابدا التعلم',
        'feature_coming': 'الميزة جاية قريب! أسئلة أكثر غادي تكون متوفرة قريب.',
        'no_quiz_lesson': 'ماكاينش اختبار لهاد الدرس.',
        'no_quiz_module': 'ماكاينش اختبار لهاد الوحدة.',
        'select_answer': 'اختار جواب.',
        'click_video': 'اضغط باش تشوف فيديو الشرح',
        'lessons': 'درس',
        'image_too_large': 'الصورة يجب تكون أقل من 1 ميجابايت',
        'select_valid_image': 'اختار صورة صحيحة',
        'username_required': 'دخل الاسم ديالك'
    }
};

// Variables globales - DARIJA PAR DÉFAUT
let currentLanguage = 'darija';
let currentUser = null;
let conversationState = 'welcome';
let currentQuiz = null;
let currentQuizAnswers = {};
let isRegistering = false;

// Base de données des utilisateurs
let usersDatabase = JSON.parse(localStorage.getItem('usersDatabase')) || {
    users: [
        {
            id: 1,
            phone: "0612345678",
            password: "123456",
            nom: "مريم الدوبونت",
            date_inscription: "2025-06-08",
            progression: 0,
            niveau_atteint: "مبتدئ",
            derniere_activite: "2025-06-08",
            photo_profile: "",
            resultats_quiz: [],
            lecons_terminees: []
        }
    ]
};

// Base de données complète du contenu éducatif Sena3timate (en darija)
const database = {
    modules: [
        {
            id: 1,
            titre: "مقدمة في الخياطة",
            description: "اكتشف الأساسيات الضرورية للخياطة: الأدوات والمواد والتقنيات الأساسية",
            niveau: "مبتدئ",
            duree_estimee: "3-4 ساعات",
            prerequis: "لا شيء"
        },
        {
            id: 2,
            titre: "التقنيات الأساسية",
            description: "اتقن الغرز الأساسية والتقنيات الأساسية للبدء بطريقة هادئة",
            niveau: "مبتدئ",
            duree_estimee: "5-6 ساعات",
            prerequis: "الوحدة 1"
        },
        {
            id: 3,
            titre: "مشاريع بسيطة",
            description: "انجز مشاريعك الأولى: جيوب، وسائد وإكسسوارات سهلة",
            niveau: "مبتدئ",
            duree_estimee: "8-10 ساعات",
            prerequis: "الوحدة 2"
        },
        {
            id: 4,
            titre: "خياطة متوسطة",
            description: "حسن تقنياتك مع مشاريع أكثر تعقيدا",
            niveau: "متوسط",
            duree_estimee: "10-12 ساعات",
            prerequis: "الوحدة 3"
        },
        {
            id: 5,
            titre: "التعديلات والإصلاحات",
            description: "تعلم إصلاح وتعديل ملابسك مثل المحترفة",
            niveau: "متوسط",
            duree_estimee: "6-8 ساعات",
            prerequis: "الوحدة 4"
        },
        {
            id: 6,
            titre: "إنشاء الملابس",
            description: "صمم وانجز ملابسك المخصصة حسب المقاس",
            niveau: "متقدم",
            duree_estimee: "15-20 ساعات",
            prerequis: "الوحدة 5"
        },
        {
            id: 7,
            titre: "تقنيات متقدمة",
            description: "اكتشف التقنيات المتقدمة للخياطة الاحترافية",
            niveau: "متقدم",
            duree_estimee: "12-15 ساعات",
            prerequis: "الوحدة 6"
        },
        {
            id: 8,
            titre: "الخياطة التجارية",
            description: "تعلم أساسيات بدء مشروع خياطة صغير",
            niveau: "متقدم",
            duree_estimee: "8-10 ساعات",
            prerequis: "الوحدة 7"
        }
    ],

    lecons: [
        // الوحدة 1: مقدمة في الخياطة
        {
            id: 1,
            id_module: 1,
            titre: "الأدوات الأساسية",
            contenu: "للبدء في الخياطة، ستحتاج إلى بعض الأدوات الأساسية. الماكينة هي أهم أداة، ويمكن أن تكون ماكينة بسيطة في البداية. مقص الخياطة ضروري لقطع القماش بدقة - لا تستعمل مقص المطبخ أبدا! الدبابيس لتثبيت القطع، المتر للقياس، والفتاق لفك الخياطات الخاطئة. أيضا الخيط عالي الجودة والإبر المختلفة حسب نوع القماش.",
            lien_media: "https://www.youtube.com/watch?v=muakUA-155I",
            conseils: "ابدأ بشراء أدوات جيدة حتى لو كانت قليلة، أفضل من أدوات كثيرة رديئة الجودة"
        },
        {
            id: 2,
            id_module: 1,
            titre: "اختيار الأقمشة",
            contenu: "اختيار القماش أمر بالغ الأهمية لنجاح مشروعك. القطن مثالي للمبتدئين - سهل العمل ولا ينزلق. الكتان جميل ولكن يتجعد بسهولة. الحرير فاخر لكن صعب للمبتدئين. الأقمشة الصناعية متنوعة - البوليستر مقاوم للتجعد، اللايكرا مطاطة. تعلم جس القماش وفهم خصائصه قبل الشراء.",
            lien_media: "https://www.youtube.com/watch?v=gPtz0n3nHDc",
            conseils: "اشتري قطعة صغيرة من القماش أولا لتجربة الخياطة عليه قبل شراء الكمية كاملة"
        },
        {
            id: 3,
            id_module: 1,
            titre: "تحضير الماكينة",
            contenu: "قبل البدء، تأكد من نظافة الماكينة وزيتها إذا لزم الأمر. إدخال الخيط العلوي يتم بتمريره عبر الأدلة المحددة. البكرة السفلية يجب ملؤها بنفس لون الخيط. ضبط التوتر مهم - جرب على قطعة قماش أولا. اختيار الإبرة المناسبة: الرقم 80 للأقمشة المتوسطة، 90 للسميكة، 70 للرقيقة.",
            lien_media: "https://www.youtube.com/watch?v=PtcLAQpkXv8",
            conseils: "احتفظ بدليل الماكينة دائما وتعلم صيانتها الأساسية"
        },
        {
            id: 4,
            id_module: 1,
            titre: "مساحة العمل المثالية",
            contenu: "مساحة العمل الجيدة ضرورية للإنتاجية والراحة. طاولة الخياطة يجب أن تكون بالارتفاع المناسب (75-80 سم). الإضاءة مهمة جدا - ضوء طبيعي أو لمبة قوية بيضاء. تنظيم الأدوات في متناول اليد. مساحة للكي قريبة. تهوية جيدة وكرسي مريح. منطقة لقطع القماش كبيرة ومسطحة.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "ضع سلة صغيرة لقصاصات القماش - يمكن إعادة استعمالها في مشاريع صغيرة"
        },
        {
            id: 5,
            id_module: 1,
            titre: "قراءة الباترونات",
            contenu: "الباترون هو خريطة لصنع الثوب. كل خط له معنى: الخطوط المتصلة للقطع، المنقطة للطي، المتقطعة للخياطة الداخلية. الرموز مهمة: النقاط للتطابق، الأسهم لاتجاه النسيج، النتش للعلامات. المقاسات مذكورة في جدول. تعلم قراءة تعليمات الخياطة خطوة بخطوة.",
            lien_media: "https://www.youtube.com/watch?v=AcaQgY6-tog",
            conseils: "ابدأ بباترونات بسيطة وواضحة، وتجنب التعقيدات في البداية"
        },

        // الوحدة 2: التقنيات الأساسية
        {
            id: 6,
            id_module: 2,
            titre: "الغرزة المستقيمة",
            contenu: "الغرزة المستقيمة هي أساس كل خياطة. طول الغرزة المثالي هو 2.5-3 مم للأقمشة العادية. ابدأ بغرزة رجوع لتثبيت بداية الخياطة. احتفظ بسرعة منتظمة وليس سريعة جدا. يدك اليمنى توجه القماش، اليسرى تحافظ على الاستقامة. انه الخياطة بغرزة رجوع مرة أخرى.",
            lien_media: "https://www.youtube.com/watch?v=xWbszypkOXo",
            conseils: "تدرب على خطوط مستقيمة ومنحنيات على قماش تجريبي قبل البدء في المشروع"
        },
        {
            id: 7,
            id_module: 2,
            titre: "غرزة الزجزاج",
            contenu: "غرزة الزجزاج لها استعمالات متعددة. لحماية الحواف من التنسيل، استعمل عرض 3-4 مم وطول 1-2 مم. للأقمشة المطاطة، عرض وطول أكبر. يمكن استعمالها للزينة أيضا. الإعدادات تختلف حسب السماكة: الرقيق يحتاج إعدادات أقل، السميك أكثر.",
            lien_media: "https://www.youtube.com/watch?v=F-_fAHILYdY",
            conseils: "جرب إعدادات مختلفة على قطعة تجريبية قبل تطبيقها على مشروعك"
        },
        {
            id: 8,
            id_module: 2,
            titre: "الحواشي المختلفة",
            contenu: "الحاشية البسيطة: اطو مرة واحدة وخيط. الحاشية المزدوجة: اطو مرتين لإخفاء الحافة الخام. الحاشية الخفية: خيط يدويا بغرز خفية. الحاشية بالبياس: للمنحنيات والدوائر. كل نوع له استعماله المناسب حسب القماش ونوع الثوب.",
            lien_media: "https://www.youtube.com/watch?v=O9YuOKJDNvY",
            conseils: "قيس الحاشية وأنت لابس الثوب للحصول على الطول الصحيح"
        },
        {
            id: 9,
            id_module: 2,
            titre: "الخياطة المنحنية",
            contenu: "الخياطة في المنحنيات تحتاج تقنية خاصة. خفف السرعة واستعمل يدك لتوجيه القماش برفق. للمنحنيات الحادة، ارفع القدم واستدر القماش مع الإبرة في الأسفل. اعمل نتش صغيرة في الحواف للمساعدة في الانحناء. تدرب على أشكال دائرية قبل المشاريع الحقيقية.",
            lien_media: "https://www.youtube.com/watch?v=iY4S_4TW-8U",
            conseils: "استعمل دبابيس أكثر في المنحنيات لضمان دقة الشكل"
        },
        {
            id: 10,
            id_module: 2,
            titre: "ربط القطع",
            contenu: "ربط قطعتين من القماش يتطلب دقة. ضع الوجهين متقابلين والحواف متطابقة. استعمل الدبابيس كل 5-8 سم أو أكثر في المنحنيات. تطابق العلامات والنتش. خيط على مسافة 1-1.5 سم من الحافة حسب الباترون. فتح الخياطة بالمكواة يعطي شكلا احترافيا.",
            lien_media: "https://www.youtube.com/watch?v=V0TXJR1EeUk",
            conseils: "دائما جرب تطابق القطع قبل التثبيت النهائي بالدبابيس"
        },

        // الوحدة 3: مشاريع بسيطة
        {
            id: 11,
            id_module: 3,
            titre: "خياطة جيب بسيط",
            contenu: "مشروعك الأول! اقطع مستطيلين من القماش 25x35 سم. ضع الوجهين متقابلين وخيط ثلاث جهات، اترك الجهة العليا مفتوحة. قلب الجيب للوجه الصحيح. اطو الحافة العليا وخيطها. يمكن إضافة شريط للإغلاق أو زر. هذا المشروع يعلمك الأساسيات: القطع، الخياطة، القلب، التشطيب.",
            lien_media: "https://www.youtube.com/watch?v=UrGvarFvYjg",
            conseils: "اختر قماش قطني متوسط السماكة لسهولة التعامل معه"
        },
        {
            id: 12,
            id_module: 3,
            titre: "غلاف وسادة مع سحاب",
            contenu: "لوسادة 40x40 سم، اقطع قطعتين 42x42 سم. في إحداهما، اقطع خط في المنتصف لتركيب السحاب. خيط السحاب بين القطعتين باستعمال قدم السحاب. ثم خيط باقي الجهات. هذا المشروع يعلمك تركيب السحاب والحصول على زوايا مربعة نظيفة.",
            lien_media: "https://www.youtube.com/watch?v=55J4EnUa0c4",
            conseils: "استعمل سحاب أطول من المطلوب، يمكن قطع الزائد بعدها"
        },
        {
            id: 13,
            id_module: 3,
            titre: "عصابة رأس مطاطة",
            contenu: "قطعة قماش 50x10 سم، اطوها نصفين بالطول واخيطي الجانب الطويل. اقلبيها للوجه الصحيح. أدخلي مطاط عرض 1 سم وطول 45 سم باستعمال دبوس أمان. خيطي الطرفين معا. هذا المشروع يعلم التعامل مع المطاط والأنابيب القماشية.",
            lien_media: "https://www.youtube.com/watch?v=piHgdLsZexI",
            conseils: "اتركي فتحة صغيرة لإدخال المطاط، واغلقيها يدويا بعدها"
        },
        {
            id: 14,
            id_module: 3,
            titre: "حافظة هاتف مبطنة",
            contenu: "اقطع قطعتين من القماش الخارجي وقطعتين من البطانة، بحجم الهاتف + 2 سم من كل جهة. أضف طبقة وسطية من الفليز للحماية. خيط الطبقات معا ثم اطو الحافة العليا. يمكن إضافة فيلكرو للإغلاق. هذا يعلم التعامل مع الطبقات المتعددة والبطانة.",
            lien_media: "https://www.youtube.com/watch?v=j4d67GTIDGI",
            conseils: "جرب الحجم بورق أولا قبل قطع القماش"
        },
        {
            id: 15,
            id_module: 3,
            titre: "كيس تسوق قابل للطي",
            contenu: "قماش خفيف 70x40 سم يطوى لكيس صغير. اقطع القطعة الرئيسية والجيب الصغير للطي. خيط أيدي من نفس القماش أو شريط جاهز. الحيلة في التصميم الذكي الذي يسمح بالطي المدمج. يعلم التخطيط والتفكير ثلاثي الأبعاد.",
            lien_media: "https://www.youtube.com/watch?v=UJucn9IEu64",
            conseils: "استعمل قماش نايلون أو بوليستر خفيف ومقاوم"
        },

        // الوحدة 4: خياطة متوسطة
        {
            id: 16,
            id_module: 4,
            titre: "تركيب السحابات المتقدم",
            contenu: "السحاب الخفي للفساتين يحتاج قدم خاص ودقة عالية. السحاب المفصول للسترات له تقنية مختلفة. سحاب الجيوب يركب قبل تجميع القطع. كل نوع له خطواته: التحضير، التثبيت، الخياطة، التشطيب. الممارسة مهمة للحصول على نتائج احترافية.",
            lien_media: "https://www.youtube.com/watch?v=RXq7Hx57bwI",
            conseils: "استعمل سحابات جيدة الجودة - الرخيصة تسبب مشاكل كثيرة"
        },
        {
            id: 17,
            id_module: 4,
            titre: "عمل عراوي الأزرار",
            contenu: "العراوي تحتاج قدم خاص في الماكينة. قيس عرض الزر أولا لتحديد طول العروة. اعمل تقوية بقطعة صغيرة من القماش أو اللاصق. ضبط الماكينة مهم: كثافة الغرز وعرض الزجزاج. جرب على قطعة تجريبية. اقطع العروة بحذر باستعمال فتاق أو مشرط.",
            lien_media: "https://www.youtube.com/watch?v=AIUhVzq_ElU",
            conseils: "ضع دبوس في نهاية العروة عند القطع لتجنب القطع الزائد"
        },
        {
            id: 18,
            id_module: 4,
            titre: "الجيوب المخفية",
            contenu: "الجيوب المخفية في الخياطات تحتاج تخطيط مسبق. تقطع مع قطع الثوب الرئيسية أو تضاف لاحقا. التركيب يتم قبل خياطة الخياطات الجانبية. شكل الجيب وعمقه مهمان للراحة. التشطيب الداخلي يجب أن يكون قوي ومقاوم للتمزق.",
            lien_media: "https://www.youtube.com/watch?v=yeBG-FBe0EE",
            conseils: "استعمل قماش البطانة أو القطن للجيوب - أقوى وأنظف"
        },
        {
            id: 19,
            id_module: 4,
            titre: "الكولات والياقات",
            contenu: "الكولات تحتاج دقة في القطع والتركيب. الكولة المدورة أسهل من المربعة. التقوية بلاصق ضرورية. خطوات التركيب: تحضير القطع، تركيب التقوية، خياطة الكولة، قلبها، تركيبها في الثوب. الكي في كل خطوة مهم للشكل النهائي.",
            lien_media: "https://www.youtube.com/watch?v=-R_zvxJirLw",
            conseils: "قص الزوايا قبل القلب للحصول على زوايا حادة نظيفة"
        },
        {
            id: 20,
            id_module: 4,
            titre: "الأكمام الأساسية",
            contenu: "تركيب الكم يحتاج فهم شكل الكتف. الكم له انحناء طبيعي يجب أن يتطابق مع فتحة الإبط. التوزيع الصحيح للقماش يمنع التكشيط. خطوات التركيب: تحضير الكم، تجميع الكتف، تثبيت الكم، خياطته، التشطيب. الكي الصحيح يعطي شكل طبيعي.",
            lien_media: "https://www.youtube.com/watch?v=10bkvXb3Kac",
            conseils: "استعمل دبابيس كثيرة وتأكد من التوزيع المتساوي قبل الخياطة"
        },

        // الوحدة 5: التعديلات والإصلاحات
        {
            id: 21,
            id_module: 5,
            titre: "تقصير البناطيل",
            contenu: "تقصير البنطلون محتاج دقة في القياس. البس البنطلون مع الحذاء المعتاد وعلم المكان المطلوب. اطو الحاشية القديمة واقطع الزائد مع ترك 4 سم للحاشية الجديدة. كوي الطية الجديدة وخيطها يدويا أو بالماكينة. احتفظ بالحاشية الأصلية إذا أمكن للشكل الطبيعي.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "دائما قيس من الداخل - الساق قد تكون أطول من الأخرى"
        },
        {
            id: 22,
            id_module: 5,
            titre: "توسيع وتضييق الملابس",
            contenu: "التوسيع محدود بعرض الخياطات الموجودة. فك الخياطات الجانبية وخيط بخياطة أضيق. للتضييق، خذ من الجوانب بالتساوي. للقمصان، يمكن التعديل في الخياطات الجانبية والكتف. للبناطيل، الوسط والجوانب. احذر من تشويه الشكل العام.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "اعمل تجربة لبس بعد كل تعديل قبل التشطيب النهائي"
        },
        {
            id: 23,
            id_module: 5,
            titre: "إصلاح التمزقات",
            contenu: "التمزق البسيط يخاط يدويا بخيط مطابق. التمزق الكبير يحتاج رقعة من الخلف. للأقمشة المنسوجة، رقعة مستطيلة. للتريكو، رقعة مرنة. التمزق في مكان واضح يمكن تحويله لتصميم زخرفي. استعمل تقنيات الترقيع المختلفة حسب القماش والمكان.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "احتفظ بقصاصات من كل مشروع للاستعمال في الإصلاحات المستقبلية"
        },
        {
            id: 24,
            id_module: 5,
            titre: "استبدال السحابات",
            contenu: "السحاب المكسور يمكن استبداله بدون فك الثوب كله. فك الخياطات حول السحاب بحذر. قيس السحاب القديم لشراء بديل مناسب. تركيب الجديد بنفس طريقة الأصلي. انتبه لاتجاه السحاب ونوعه. اعمل تجربة للتأكد من العمل السليم قبل التشطيب.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "التقط صور للسحاب الأصلي قبل الفك للمرجع أثناء التركيب"
        },
        {
            id: 25,
            id_module: 5,
            titre: "تعديل الأكمام",
            contenu: "تقصير الكم من الكف سهل، من الكتف معقد. للتقصير من الكف، فك الحاشية واقطع المطلوب مع ترك حاشية جديدة. للتطويل، أضف قطعة مطابقة أو مختلفة للتنويع. تعديل عرض الكم يتم من الخياطة السفلية مع الحفاظ على شكل الإبط.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "قيس الكم وأنت مفرود الذراع للحصول على الطول الصحيح"
        },

        // الوحدة 6: إنشاء الملابس
        {
            id: 26,
            id_module: 6,
            titre: "أخذ المقاسات الصحيحة",
            contenu: "المقاسات الدقيقة أساس الثوب المضبوط. استعمل متر مرن وخذ المقاسات على الجسم مباشرة أو فوق ملابس رقيقة. المقاسات الأساسية: دوران الصدر، الوسط، الورك، طول الظهر، طول الكم، طول البنطلون. سجل كل المقاسات وتاريخ أخذها. راجع المقاسات قبل كل مشروع.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "اطلب مساعدة شخص آخر لضمان دقة المقاسات، خاصة الظهر"
        },
        {
            id: 27,
            id_module: 6,
            titre: "تعديل الباترونات",
            contenu: "الباترونات التجارية تحتاج تعديل للمقاسات الشخصية. قارن مقاساتك مع جدول الباترون. التعديلات الشائعة: تطويل أو تقصير الجذع، تعديل عرض الصدر، تكبير أو تصغير عام. اعمل التعديلات على ورق الباترون قبل القطع. احتفظ بنسخة أصلية للمراجع.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "ابدأ بباترونات بسيطة قبل التعامل مع التعديلات المعقدة"
        },
        {
            id: 28,
            id_module: 6,
            titre: "خياطة تنورة مستقيمة",
            contenu: "التنورة المستقيمة مشروع مثالي لتعلم أساسيات الملابس. البدء بباترون بسيط أو رسم واحد بنفسك. قطع الأمام والخلف مع إضافة سحاب خلفي. خياطة الجوانب، تركيب السحاب، عمل الحزام، التشطيب بالحاشية. التجربة مطلوبة عدة مرات للضبط.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "اعمل نموذج من قماش رخيص أولا قبل استعمال القماش النهائي"
        },
        {
            id: 29,
            id_module: 6,
            titre: "قميص بسيط بأكمام",
            contenu: "القميص البسيط يجمع معظم تقنيات الخياطة. البدء بباترون واضح التعليمات. تجميع الأمام والخلف، تركيب الأكمام، عمل الياقة، العراوي والأزرار، التشطيبات النهائية. كل خطوة تحتاج دقة وصبر. النتيجة ثوب كامل لابس للفخر.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "اقرأ كل التعليمات قبل البدء وتأكد من فهم كل خطوة"
        },
        {
            id: 30,
            id_module: 6,
            titre: "فستان بسيط أنيق",
            contenu: "الفستان الأول يكون تصميم بسيط: مستقيم أو بتوسعة خفيفة. باترون محتاج ضبط دقيق للمقاسات. تقنيات جديدة: تركيب البطانة، السحاب الخفي، التشطيبات الداخلية. التجربة مرات عديدة للضبط. النتيجة فستان أنيق مصنوع بالحب والإتقان.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "اختر قماش متسامح مع الأخطاء للمشروع الأول - تجنب الحرير والكريب"
        },

        // الوحدة 7: تقنيات متقدمة
        {
            id: 31,
            id_module: 7,
            titre: "الخياطة الفرنسية",
            contenu: "الخياطة الفرنسية تخفي جميع الحواف الخام وتعطي تشطيبا فاخرا. تخاط القطع من الوجه أولا بخياطة ضيقة، ثم تقلب وتخاط من الظهر بخياطة أعرض تغطي الأولى. النتيجة خياطة قوية وأنيقة من الداخل والخارج. مثالية للملابس الداخلية والقمصان الرقيقة.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "تحتاج قماش رقيق ومرن - صعبة مع الأقمشة السميكة"
        },
        {
            id: 32,
            id_module: 7,
            titre: "تقنيات الكشكش والطيات",
            contenu: "الكشكش يضيف حجم وحركة للثوب. تحتاج قماش أطول من المطلوب 1.5-3 مرات حسب الكثافة المرغوبة. تقنيات التجميع: الخياطة اليدوية، الماكينة بخيط مزدوج، أو الرباط المطاط. الطيات منتظمة أو عشوائية. التثبيت والكي مهمان للشكل النهائي.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "وزع الكشكش بالتساوي واستعمل دبابيس كثيرة قبل الخياطة النهائية"
        },
        {
            id: 33,
            id_module: 7,
            titre: "التطريز والزخرفة",
            contenu: "التطريز اليدوي يضيف لمسة شخصية فريدة. الغرز الأساسية: النقطة، الصلب، الفيستون، الحلقة. التطريز بالماكينة أسرع ومنتظم. تقنيات الزخرفة: الترقيع، الأبليك، الدانتيل، الأشرطة. التخطيط مهم قبل البدء - ارسم التصميم على الورق أولا.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "ابدأ بتصاميم بسيطة ولا تزحف القطعة كلها في المرة الأولى"
        },
        {
            id: 34,
            id_module: 7,
            titre: "التعامل مع الأقمشة الصعبة",
            contenu: "الحرير، الساتان، الشيفون، الدانتيل - كل منها له تحدياته. الحرير ينزلق - استعمل دبابيس رفيعة وإبر حادة. الشيفون يحتاج طبقة ورق تحته أثناء الخياطة. الدانتيل يقطع بحذر للحفاظ على النقشة. القماش المخملي له اتجاه - كل القطع في نفس الاتجاه.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "اشتر قماش زائد للتجارب - الأقمشة الفاخرة لا تسامح الأخطاء"
        },
        {
            id: 35,
            id_module: 7,
            titre: "صناعة الإكسسوارات",
            contenu: "الإكسسوارات المصنوعة بنفسك تكمل الإطلالة. عصابات الرأس، الحقائب الصغيرة، الأوشحة، ربطات الشعر. كل قطعة مشروع صغير يعلم تقنية جديدة. التنسيق مع الملابس مهم - الألوان والأقمشة المتطابقة. فرصة لاستعمال قصاصات الأقمشة الجميلة.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "الإكسسوارات هدايا جميلة ومناسبة للمبتدئين لبناء الثقة"
        },

        // الوحدة 8: الخياطة التجارية
        {
            id: 36,
            id_module: 8,
            titre: "تخطيط مشروع الخياطة",
            contenu: "بدء مشروع خياطة يحتاج تخطيط دقيق. تحديد التخصص: ملابس الأطفال، فساتين المناسبات، تعديلات، أم عام؟ دراسة السوق والأسعار. حساب التكلفة: القماش، الخيط، الأدوات، الوقت. تحديد الأسعار للربح. التسويق والإعلان. بدء صغير ونمو تدريجي.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "ابدأ بالأصدقاء والأقارب لبناء سمعة وتطوير المهارات"
        },
        {
            id: 37,
            id_module: 8,
            titre: "التعامل مع العملاء",
            contenu: "العميل الراضي أهم من الربح السريع. الاستماع الجيد لفهم المطلوب بدقة. تسجيل كل التفاصيل كتابة. تحديد مواعيد واقعية وحفظها. التواصل المستمر أثناء العمل. التعامل مع التعديلات والشكاوى بصبر واحترافية. العلاقة الطيبة تضمن عملاء دائمين.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "دائما وضح ما ممكن وما مستحيل من البداية لتجنب المشاكل"
        },
        {
            id: 38,
            id_module: 8,
            titre: "إدارة الوقت والمواعيد",
            contenu: "الوقت أهم مورد في مشروع الخياطة. تقدير الوقت اللازم لكل نوع عمل. تنظيم جدول العمل مع هامش للطوارئ. تقسيم المشاريع الكبيرة لمراحل. عدم قبول أعمال أكثر من الطاقة. الالتزام بالمواعيد يبني السمعة الطيبة. التأخير يفقد العملاء.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "اعمل قائمة أولويات يومية والتزم بها - لا تؤجل أعمال اليوم للغد"
        },
        {
            id: 39,
            id_module: 8,
            titre: "التكلفة والتسعير",
            contenu: "حساب التكلفة الحقيقية ضروري للربح. تكلفة المواد: القماش، الخيط، الأزرار، السحابات. تكلفة الوقت: احسب راتب الساعة المطلوب. التكاليف الثابتة: الكهرباء، الأدوات، المساحة. هامش الربح المعقول. دراسة أسعار المنافسين. التسعير العادل يرضي الطرفين.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "لا تقبل أسعار قليلة جدا - تقدر عملك وجهدك يقدرك الناس"
        },
        {
            id: 40,
            id_module: 8,
            titre: "التسويق والنمو",
            contenu: "التسويق الناجح يبني العمل المستدام. الكلمة الطيبة أقوى إعلان. نماذج الأعمال للعرض مهمة. التصوير الجيد للأعمال ضروري. وسائل التواصل الاجتماعي فعالة ومجانية. المشاركة في المعارض والأسواق. التطوير المستمر للمهارات. النمو التدريجي أثبت من السرعة الزائدة.",
            lien_media: "non_disponible", // Pas encore disponible en Darija
            conseils: "اصنع علامة تجارية بسيطة واضحة - الاسم والشعار وطريقة التواصل"
        }
    ],

    quiz: [
        // أسئلة الوحدة 1
        {
            id: 1,
            id_lecon: 1,
            question: "ما هي الأداة الأهم لقطع القماش؟",
            options: "مقص المطبخ;مقص الخياطة;قاطع;سكين",
            bonne_reponse: "مقص الخياطة",
            explication: "مقص الخياطة مصمم خصيصا لقطع القماش بطريقة نظيفة ودقيقة، دون إتلافه."
        },
        {
            id: 2,
            id_lecon: 2,
            question: "أي قماش الأكثر نصحا للمبتدئين؟",
            options: "الحرير;القطن;الجيرسي;الساتان",
            bonne_reponse: "القطن",
            explication: "القطن سهل العمل معه، لا ينزلق ويسامح أخطاء المبتدئين."
        },
        {
            id: 3,
            id_lecon: 3,
            question: "ما هو الرقم المناسب للإبرة مع الأقمشة المتوسطة؟",
            options: "70;80;90;100",
            bonne_reponse: "80",
            explication: "الإبرة رقم 80 مناسبة للأقمشة متوسطة السماكة مثل القطن العادي."
        },
        {
            id: 4,
            id_lecon: 4,
            question: "ما هو الارتفاع المثالي لطاولة الخياطة؟",
            options: "65-70 سم;75-80 سم;85-90 سم;95-100 سم",
            bonne_reponse: "75-80 سم",
            explication: "هذا الارتفاع يوفر راحة العمل ويقلل إجهاد الظهر والرقبة."
        },
        {
            id: 5,
            id_lecon: 5,
            question: "ماذا تعني الخطوط المنقطة في الباترون؟",
            options: "خط القطع;خط الطي;خط الخياطة الداخلية;اتجاه النسيج",
            bonne_reponse: "خط الطي",
            explication: "الخطوط المنقطة تشير إلى مكان الطي في الباترون."
        },

        // أسئلة الوحدة 2
        {
            id: 6,
            id_lecon: 6,
            question: "ما هو الطول المنصوح به للغرزة العادية؟",
            options: "1-1.5 مم;2.5-3 مم;4-5 مم;6 مم",
            bonne_reponse: "2.5-3 مم",
            explication: "طول من 2.5 إلى 3 مم يعطي خياطة قوية وجميلة لمعظم الأقمشة العادية."
        },
        {
            id: 7,
            id_lecon: 7,
            question: "ما هو الاستخدام الرئيسي لغرزة الزجزاج؟",
            options: "الزينة فقط;حماية الحواف;خياطة الأزرار;وضع علامات على القماش",
            bonne_reponse: "حماية الحواف",
            explication: "غرزة الزجزاج تمنع تنسيل حواف القماش ويمكن استخدامها أيضا للأقمشة المطاطة."
        },
        {
            id: 8,
            id_lecon: 8,
            question: "ما هي أفضل طريقة لحاشية القمصان الرقيقة؟",
            options: "الحاشية البسيطة;الحاشية المزدوجة;الحاشية الخفية;الحاشية بالبياس",
            bonne_reponse: "الحاشية المزدوجة",
            explication: "الحاشية المزدوجة تخفي الحافة الخام وتعطي تشطيبا نظيفا للأقمشة الرقيقة."
        },
        {
            id: 9,
            id_lecon: 9,
            question: "عند خياطة المنحنيات الحادة، ماذا تفعل؟",
            options: "أسرع في الخياطة;أرفع القدم وأستدير;أستعمل غرزة أطول;أضغط أقوى",
            bonne_reponse: "أرفع القدم وأستدير",
            explication: "رفع القدم مع ترك الإبرة في القماش يسمح بالاستدارة الدقيقة في المنحنيات."
        },
        {
            id: 10,
            id_lecon: 10,
            question: "ما هي المسافة المعتادة للخياطة من الحافة؟",
            options: "0.5 سم;1-1.5 سم;2-2.5 سم;3 سم",
            bonne_reponse: "1-1.5 سم",
            explication: "هذه المسافة توفر قوة كافية للخياطة مع السماح بالتعديلات المستقبلية."
        },

        // أسئلة الوحدة 3
        {
            id: 11,
            id_lecon: 11,
            question: "ما هي الخطوة الأولى لخياطة جيب؟",
            options: "تركيب السحاب;قطع القماش;تجميع القطع;عمل التشطيبات",
            bonne_reponse: "قطع القماش",
            explication: "يجب دائما البدء بقطع جميع القطع اللازمة حسب الباترون أو المقاسات."
        },
        {
            id: 12,
            id_lecon: 12,
            question: "لماذا نستعمل قدم السحاب؟",
            options: "لتقوية الخياطة;للخياطة قريبا من أسنان السحاب;لتجنب كسر الإبرة;لتسهيل إدخال الخيط",
            bonne_reponse: "للخياطة قريبا من أسنان السحاب",
            explication: "قدم السحاب يسمح بالخياطة قريبا جدا من أسنان السحاب دون عوائق."
        },
        {
            id: 13,
            id_lecon: 13,
            question: "ما هو طول المطاط المناسب لعصابة رأس طولها 50 سم؟",
            options: "45 سم;50 سم;55 سم;60 سم",
            bonne_reponse: "45 سم",
            explication: "المطاط يجب أن يكون أقصر من القماش ليعطي الشد المطلوب."
        },
        {
            id: 14,
            id_lecon: 14,
            question: "ما فائدة الطبقة الوسطية في حافظة الهاتف؟",
            options: "الزينة;الحماية;تسهيل الخياطة;توفير المال",
            bonne_reponse: "الحماية",
            explication: "الطبقة الوسطية من الفليز تحمي الهاتف من الصدمات والخدوش."
        },
        {
            id: 15,
            id_lecon: 15,
            question: "أي نوع قماش أفضل للكيس القابل للطي؟",
            options: "القطن السميك;النايلون الخفيف;الصوف;الحرير",
            bonne_reponse: "النايلون الخفيف",
            explication: "النايلون خفيف ومقاوم ومناسب للطي المتكرر."
        },

        // أسئلة الوحدة 4
        {
            id: 16,
            id_lecon: 16,
            question: "أي قدم ماكينة نستخدم لتركيب السحاب؟",
            options: "القدم العادية;قدم السحاب;قدم العراوي;قدم الحاشية",
            bonne_reponse: "قدم السحاب",
            explication: "قدم السحاب يسمح بالخياطة قريبا جدا من أسنان السحاب."
        },
        {
            id: 17,
            id_lecon: 17,
            question: "قبل عمل العروة، ماذا نفعل؟",
            options: "نقيس عرض الزر;نقوي المكان;نجرب على قطعة تجريبية;كل ما سبق",
            bonne_reponse: "كل ما سبق",
            explication: "كل هذه الخطوات ضرورية للحصول على عروة مثالية."
        },
        {
            id: 18,
            id_lecon: 18,
            question: "متى نركب الجيوب المخفية؟",
            options: "بعد انتهاء الثوب;قبل خياطة الخياطات الجانبية;مع تركيب السحاب;في النهاية",
            bonne_reponse: "قبل خياطة الخياطات الجانبية",
            explication: "الجيوب المخفية تركب في القطع المنفصلة قبل تجميع الثوب."
        },
        {
            id: 19,
            id_lecon: 19,
            question: "ما أهمية التقوية في الكولات؟",
            options: "الزينة;الشكل والثبات;تسهيل الخياطة;لا فائدة منها",
            bonne_reponse: "الشكل والثبات",
            explication: "التقوية تعطي الكولة شكلها المطلوب وتحافظ عليه مع الاستعمال."
        },
        {
            id: 20,
            id_lecon: 20,
            question: "ما أصعب جزء في تركيب الكم؟",
            options: "قطع الكم;تطابق الانحناء;الخياطة;التشطيب",
            bonne_reponse: "تطابق الانحناء",
            explication: "تطابق انحناء الكم مع فتحة الإبط يحتاج خبرة ودقة."
        },

        // أسئلة الوحدة 5
        {
            id: 21,
            id_lecon: 21,
            question: "كيف نقيس الطول لتقصير بنطلون؟",
            options: "مسطح على الطاولة;ملبوس مع الحذاء;معلق;راكع",
            bonne_reponse: "ملبوس مع الحذاء",
            explication: "يجب لبس البنطلون مع الحذاء المعتاد للحصول على الطول الصحيح."
        },
        {
            id: 22,
            id_lecon: 22,
            question: "عند توسيع ثوب، ما الذي يحدد إمكانية التوسيع؟",
            options: "نوع القماش;عرض الخياطات الموجودة;لون الثوب;عمر الثوب",
            bonne_reponse: "عرض الخياطات الموجودة",
            explication: "التوسيع محدود بعرض الخياطات - لا يمكن توسيع أكثر من الموجود."
        },
        {
            id: 23,
            id_lecon: 23,
            question: "أي نوع رقعة نستعمل للأقمشة المطاطة؟",
            options: "رقعة صلبة;رقعة مرنة;رقعة جلدية;رقعة ورقية",
            bonne_reponse: "رقعة مرنة",
            explication: "الأقمشة المطاطة تحتاج رقعة مرنة للحفاظ على خصائص المرونة."
        },
        {
            id: 24,
            id_lecon: 24,
            question: "قبل فك السحاب المكسور، ماذا نفعل؟",
            options: "نشتري سحاب جديد;نقيس السحاب القديم;نصور موقعه;نفك الثوب كله",
            bonne_reponse: "نقيس السحاب القديم",
            explication: "قياس السحاب القديم ضروري لشراء بديل مناسب بنفس الطول والنوع."
        },
        {
            id: 25,
            id_lecon: 25,
            question: "أين نقيس الكم للطول الصحيح؟",
            options: "والذراع مفرود;والذراع مطوي;والذراع مرفوع;كل الأوضاع متساوية",
            bonne_reponse: "والذراع مفرود",
            explication: "الذراع المفرود يعطي الطول الطبيعي للكم أثناء الحركة العادية."
        },

        // أسئلة الوحدة 6
        {
            id: 26,
            id_lecon: 26,
            question: "ما أهم أداة لأخذ المقاسات؟",
            options: "المسطرة;المتر المرن;المثلث;الكومباس",
            bonne_reponse: "المتر المرن",
            explication: "المتر المرن يتبع انحناءات الجسم ويعطي مقاسات دقيقة."
        },
        {
            id: 27,
            id_lecon: 27,
            question: "متى نعدل الباترون؟",
            options: "بعد القطع;أثناء الخياطة;قبل القطع;بعد انتهاء الثوب",
            bonne_reponse: "قبل القطع",
            explication: "التعديلات تتم على ورق الباترون قبل قطع القماش لتجنب الهدر."
        },
        {
            id: 28,
            id_lecon: 28,
            question: "ما أول خطوة في خياطة تنورة مستقيمة؟",
            options: "تركيب السحاب;خياطة الجوانب;قطع القماش;عمل الحزام",
            bonne_reponse: "قطع القماش",
            explication: "القطع الصحيح أساس نجاح أي مشروع خياطة."
        },
        {
            id: 29,
            id_lecon: 29,
            question: "ما أهمية النموذج التجريبي؟",
            options: "توفير المال;تجربة الحجم والشكل;تعلم التقنيات;كل ما سبق",
            bonne_reponse: "كل ما سبق",
            explication: "النموذج التجريبي يوفر المال والوقت ويسمح بالتعديلات قبل القماش النهائي."
        },
        {
            id: 30,
            id_lecon: 30,
            question: "أي قماش ننصح به للفستان الأول؟",
            options: "الحرير;القطن المتوسط;الكريب;الشيفون",
            bonne_reponse: "القطن المتوسط",
            explication: "القطن المتوسط متسامح مع الأخطاء وسهل التعامل معه للمبتدئين."
        },

        // أسئلة الوحدة 7
        {
            id: 31,
            id_lecon: 31,
            question: "ما مميزات الخياطة الفرنسية؟",
            options: "السرعة;إخفاء الحواف الخام;توفير الخيط;سهولة العمل",
            bonne_reponse: "إخفاء الحواف الخام",
            explication: "الخياطة الفرنسية تخفي جميع الحواف الخام وتعطي تشطيبا فاخرا."
        },
        {
            id: 32,
            id_lecon: 32,
            question: "كم مرة نحتاج قماش أكثر للكشكش المتوسط؟",
            options: "1.5 مرة;2 مرة;2.5 مرة;3 مرات",
            bonne_reponse: "2 مرة",
            explication: "ضعف الطول يعطي كشكش متوسط الكثافة مناسب لمعظم التطبيقات."
        },
        {
            id: 33,
            id_lecon: 33,
            question: "ما أول خطوة في التطريز؟",
            options: "اختيار الخيط;رسم التصميم;قطع القماش;بدء الخياطة",
            bonne_reponse: "رسم التصميم",
            explication: "التخطيط والرسم أولا يضمن نتيجة منتظمة وجميلة."
        },
        {
            id: 34,
            id_lecon: 34,
            question: "ما المشكلة الرئيسية مع الحرير؟",
            options: "السعر;الانزلاق;التنظيف;اللون",
            bonne_reponse: "الانزلاق",
            explication: "الحرير ينزلق أثناء القطع والخياطة ويحتاج تقنيات خاصة."
        },
        {
            id: 35,
            id_lecon: 35,
            question: "ما فائدة صناعة الإكسسوارات للمبتدئين؟",
            options: "بناء الثقة;تعلم تقنيات جديدة;استغلال القصاصات;كل ما سبق",
            bonne_reponse: "كل ما سبق",
            explication: "الإكسسوارات مشاريع صغيرة مثالية لتطوير المهارات وبناء الثقة."
        },

        // أسئلة الوحدة 8
        {
            id: 36,
            id_lecon: 36,
            question: "ما أول خطوة في تخطيط مشروع خياطة تجاري؟",
            options: "شراء الأدوات;تحديد التخصص;البحث عن عملاء;تعلم تقنيات جديدة",
            bonne_reponse: "تحديد التخصص",
            explication: "تحديد التخصص يوجه كل القرارات التالية في المشروع."
        },
        {
            id: 37,
            id_lecon: 37,
            question: "ما أهم صفة في التعامل مع العملاء؟",
            options: "السرعة;الاستماع الجيد;الأسعار المنخفضة;الخبرة الطويلة",
            bonne_reponse: "الاستماع الجيد",
            explication: "الاستماع الجيد يضمن فهم المطلوب بدقة ويقلل المشاكل."
        },
        {
            id: 38,
            id_lecon: 38,
            question: "ما أهمية ترك هامش وقت في المواعيد؟",
            options: "زيادة الربح;مواجهة الطوارئ;إبطاء العمل;لا فائدة منه",
            bonne_reponse: "مواجهة الطوارئ",
            explication: "هامش الوقت يساعد في مواجهة المشاكل غير المتوقعة والحفاظ على المواعيد."
        },
        {
            id: 39,
            id_lecon: 39,
            question: "ما يجب أن يشمل حساب التكلفة؟",
            options: "المواد فقط;الوقت فقط;المواد والوقت والتكاليف الثابتة;الربح فقط",
            bonne_reponse: "المواد والوقت والتكاليف الثابتة",
            explication: "حساب شامل للتكلفة ضروري لتحديد أسعار مربحة وعادلة."
        },
        {
            id: 40,
            id_lecon: 40,
            question: "ما أقوى طريقة تسويق لمشروع الخياطة؟",
            options: "الإعلانات المدفوعة;وسائل التواصل الاجتماعي;الكلمة الطيبة;المعارض",
            bonne_reponse: "الكلمة الطيبة",
            explication: "الكلمة الطيبة من العملاء الراضين هي أقوى إعلان وأكثر مصداقية."
        }
    ],

    glossaire: [
        {
            terme: "باترون",
            definition: "نموذج من الورق أو الكرتون يستخدم كدليل لقطع قطع الثوب من القماش",
            exemple: "أستخدم باترون بوردا لخياطة فستاني",
            categorie: "أساسيات"
        },
        {
            terme: "حاشية",
            definition: "طي حافة القماش وخياطته لتجنب التنسيل وإعطاء لمسة نهائية نظيفة",
            exemple: "يجب أن أعمل حاشية لتنورتي لأنها طويلة جدا",
            categorie: "تقنيات"
        },
        {
            terme: "سرفلة",
            definition: "غرزة تجمع وتحمي الحواف في عملية واحدة، تتم بماكينة السرفلة",
            exemple: "السرفلة تعطي تشطيبا احترافيا للخياطات",
            categorie: "تقنيات"
        },
        {
            terme: "بياس",
            definition: "شريط قماش مقطوع بالقطر بالنسبة لاتجاه النسيج، يستخدم للتحديد والتشطيب",
            exemple: "أستخدم البياس لتشطيب فتحة الرقبة في البلوزة",
            categorie: "مواد"
        },
        {
            terme: "غرزة مستقيمة",
            definition: "الغرزة الأساسية في ماكينة الخياطة، تشكل خطا مستقيما من الغرز المنتظمة",
            exemple: "الغرزة المستقيمة مثالية لتجميع قطع مشروعي",
            categorie: "تقنيات"
        },
        {
            terme: "بكرة",
            definition: "بكرة صغيرة تحتوي على الخيط السفلي في ماكينة الخياطة",
            exemple: "يجب أن أملأ البكرة قبل البدء في الخياطة",
            categorie: "أدوات"
        },
        {
            terme: "دبابيس",
            definition: "قضبان معدنية صغيرة مدببة تستخدم لتثبيت قطع القماش مؤقتا",
            exemple: "أدبس القطع قبل خياطتها",
            categorie: "أدوات"
        },
        {
            terme: "فتاق",
            definition: "أداة صغيرة مدببة تستخدم لفك الخياطات وإزالة الخيوط",
            exemple: "أستخدم الفتاق لتصحيح خياطتي الخاطئة",
            categorie: "أدوات"
        },
        {
            terme: "اتجاه النسيج",
            definition: "الاتجاه الطولي للقماش، موازيا للكنار، الذي يعطي أفضل ثبات للثوب",
            exemple: "يجب احترام اتجاه النسيج المبين على الباترون",
            categorie: "أساسيات"
        },
        {
            terme: "كنار",
            definition: "الحافة المكتملة للقماش أثناء النسج، التي لا تتنسل",
            exemple: "أضع قطع الباترون متجنبة الكنار",
            categorie: "أساسيات"
        },
        {
            terme: "طية",
            definition: "طي مخيط يسمح بتعديل الثوب حسب الشكل",
            exemple: "طيات الصدر تعطي شكلا للقميص",
            categorie: "تقنيات"
        },
        {
            terme: "مارج الخياطة",
            definition: "المسافة بين حافة القماش وخط الخياطة، عادة 1 إلى 1.5 سم",
            exemple: "لا تنس إضافة مارج الخياطة للباترون",
            categorie: "أساسيات"
        },
        {
            terme: "حراري لاصق",
            definition: "مادة تلتصق بالقماش تحت تأثير حرارة المكواة",
            exemple: "أستخدم البطانة الحرارية اللاصقة لتقوية الياقة",
            categorie: "مواد"
        },
        {
            terme: "غرزة رجوع",
            definition: "تقنية لتأمين بداية ونهاية الخياطة بخياطة بضع غرز في الاتجاه المعاكس",
            exemple: "أعمل دائما غرزة رجوع لتثبيت خياطتي",
            categorie: "تقنيات"
        },
        {
            terme: "علامة",
            definition: "قطع صغير في مارج الخياطة لوضع علامة أو تسهيل المنحنيات",
            exemple: "العلامات تساعدني على تجميع القطع المنحنية جيدا",
            categorie: "تقنيات"
        },
        {
            terme: "ظهر",
            definition: "الوجه غير المرئي للقماش، عكس الوجه",
            exemple: "أضع القطع ظهر ضد ظهر لهذه الخياطة",
            categorie: "أساسيات"
        },
        {
            terme: "وجه",
            definition: "الوجه المرئي والجميل للقماش",
            exemple: "وجه القماش له نقشة زهرية جميلة",
            categorie: "أساسيات"
        },
        {
            terme: "عروة",
            definition: "فتحة محاطة بغرز مكثفة مخصصة لاستقبال زر",
            exemple: "ماكينتي تعمل عراوي جميلة تلقائيا",
            categorie: "تقنيات"
        },
        {
            terme: "مطاط",
            definition: "شريط قابل للتمدد يستخدم لتعديل الملابس",
            exemple: "أخيط مطاطا في خصر التنورة",
            categorie: "مواد"
        },
        {
            terme: "بطانة",
            definition: "طبقة داخلية من القماش تحمي وتحسن شكل الثوب الخارجي",
            exemple: "البطانة تعطي الجاكيت شكلا أنيقا ومريحا",
            categorie: "مواد"
        },
        {
            terme: "كشكش",
            definition: "تجميع القماش بطيات صغيرة منتظمة لإعطاء حجم وحركة",
            exemple: "الكشكش في أسفل الفستان يعطيه شكلا رومانسيا",
            categorie: "تقنيات"
        },
        {
            terme: "أبليك",
            definition: "تقنية زخرفة بتثبيت قطع قماش صغيرة على قماش أساسي",
            exemple: "استعملت الأبليك لزخرفة قميص ابنتي",
            categorie: "زخرفة"
        },
        {
            terme: "تطريز",
            definition: "فن تزيين القماش بغرز ملونة ومتنوعة",
            exemple: "التطريز اليدوي يضيف لمسة شخصية فريدة",
            categorie: "زخرفة"
        },
        {
            terme: "قدم الماكينة",
            definition: "الجزء القابل للتغيير في الماكينة الذي يضغط على القماش أثناء الخياطة",
            exemple: "قدم السحاب يساعد في تركيب السحابات بدقة",
            categorie: "أدوات"
        },
        {
            terme: "توتر الخيط",
            definition: "قوة شد الخيط في الماكينة التي تؤثر على جودة الغرزة",
            exemple: "ضبط توتر الخيط مهم للحصول على غرز متوازنة",
            categorie: "أساسيات"
        },
        {
            terme: "قياس",
            definition: "عملية أخذ أبعاد الجسم لضمان مقاس مناسب للثوب",
            exemple: "أخذ القياسات بدقة يضمن ثوبا مضبوطا",
            categorie: "أساسيات"
        },
        {
            terme: "تسريج",
            definition: "خياطة مؤقتة بغرز طويلة لتثبيت القطع قبل الخياطة النهائية",
            exemple: "التسريج يساعد في ضبط الشكل قبل الخياطة النهائية",
            categorie: "تقنيات"
        },
        {
            terme: "منحنى الإبط",
            definition: "الانحناء الطبيعي في فتحة الذراع لتناسب شكل الجسم",
            exemple: "ضبط منحنى الإبط مهم لراحة الحركة",
            categorie: "أساسيات"
        },
        {
            terme: "خياطة فرنسية",
            definition: "تقنية خياطة تخفي جميع الحواف الخام داخل الخياطة",
            exemple: "الخياطة الفرنسية تعطي تشطيبا فاخرا للقمصان",
            categorie: "تقنيات"
        },
        {
            terme: "نتش",
            definition: "علامة صغيرة في الباترون لمساعدة في تطابق القطع",
            exemple: "النتش يساعد في تطابق خط الكتف بدقة",
            categorie: "أساسيات"
        },
        {
            terme: "كم راجلان",
            definition: "نوع كم يخاط بخط مائل من الرقبة إلى الإبط",
            exemple: "الكم الراجلان مريح ومناسب للملابس الرياضية",
            categorie: "تقنيات"
        },
        {
            terme: "ياقة",
            definition: "الجزء الذي يحيط بالرقبة في الثوب",
            exemple: "الياقة المدببة تعطي شكلا رسميا للقميص",
            categorie: "أجزاء الثوب"
        },
        {
            terme: "حزام",
            definition: "شريط من القماش يلف حول الوسط لتثبيت أو تزيين الثوب",
            exemple: "الحزام يبرز خط الوسط في الفستان",
            categorie: "أجزاء الثوب"
        },
        {
            terme: "جيب ورقي",
            definition: "جيب مسطح مخيط على سطح الثوب",
            exemple: "الجيب الورقي على القميص عملي وأنيق",
            categorie: "أجزاء الثوب"
        },
        {
            terme: "جيب منحني",
            definition: "جيب مدفون داخل خياطة الثوب",
            exemple: "الجيب المنحني مخفي ولا يؤثر على شكل الثوب",
            categorie: "أجزاء الثوب"
        },
        {
            terme: "فيلكرو",
            definition: "نوع إغلاق بشريطين أحدهما خشن والآخر ناعم",
            exemple: "الفيلكرو سهل الاستعمال للأطفال والمسنين",
            categorie: "مواد"
        },
        {
            terme: "كباس",
            definition: "نوع إغلاق معدني أو بلاستيكي يتكون من جزأين ينضغطان معا",
            exemple: "الكباس قوي ومناسب للملابس الثقيلة",
            categorie: "مواد"
        },
        {
            terme: "دانتيل",
            definition: "قماش شفاف مزخرف بخيوط رفيعة",
            exemple: "الدانتيل يضيف لمسة رومانسية للفستان",
            categorie: "مواد"
        },
        {
            terme: "تل",
            definition: "قماش شفاف خفيف جدا",
            exemple: "التل يستخدم في طبقات الفساتين المنفوشة",
            categorie: "مواد"
        },
        {
            terme: "ساتان",
            definition: "قماش لامع بسطح أملس ونعم",
            exemple: "الساتان يعطي مظهرا فاخرا للفساتين",
            categorie: "مواد"
        },
        {
            terme: "شيفون",
            definition: "قماش خفيف شفاف ومتدفق",
            exemple: "الشيفون مثالي للفساتين الصيفية الخفيفة",
            categorie: "مواد"
        },
        {
            terme: "جيرسي",
            definition: "قماش مطاط مريح ومرن",
            exemple: "الجيرسي مناسب للتي شيرت والملابس المريحة",
            categorie: "مواد"
        },
        {
            terme: "دينيم",
            definition: "قماش قطني سميك يستخدم للجينز",
            exemple: "الدينيم قوي ومقاوم للاستعمال اليومي",
            categorie: "مواد"
        },
        {
            terme: "فليز",
            definition: "قماش صناعي ناعم ودافئ",
            exemple: "الفليز مثالي للملابس الشتوية والبطانات",
            categorie: "مواد"
        },
        {
            terme: "خياطة مزدوجة",
            definition: "تقنية خياطة بخطين متوازيين لتقوية وتزيين",
            exemple: "الخياطة المزدوجة تقوي حواف الجينز",
            categorie: "تقنيات"
        },
        {
            terme: "تدكيك",
            definition: "عمل طيات صغيرة منتظمة للتشكيل أو الزينة",
            exemple: "التدكيك يعطي شكلا مميزا لصدر القميص",
            categorie: "تقنيات"
        },
        {
            terme: "شق",
            definition: "فتحة في الثوب لسهولة الحركة أو التصميم",
            exemple: "الشق في التنورة يسهل المشي",
            categorie: "تقنيات"
        },
        {
            terme: "كسرة",
            definition: "طية كبيرة في القماش لإعطاء شكل أو راحة",
            exemple: "الكسرة في الظهر تعطي راحة للحركة",
            categorie: "تقنيات"
        },
        {
            terme: "تقوية",
            definition: "طبقة إضافية لتقوية مناطق معينة في الثوب",
            exemple: "التقوية في الجيوب تمنع التمزق",
            categorie: "تقنيات"
        }
    ],

    ressources: [
        // فيديوهات تعليمية
        {
            id: 1,
            type: "فيديو",
            titre: "البدء في الخياطة - الأساسيات الضرورية",
            url: "https://www.youtube.com/watch?v=sewing-basics-arabic",
            langue: "عربي",
            duree: "15 دقيقة",
            niveau: "مبتدئ",
            description: "شرح شامل للأدوات الأساسية وكيفية البدء في تعلم الخياطة"
        },
        {
            id: 2,
            type: "فيديو",
            titre: "كيفية اختيار ماكينة الخياطة المناسبة",
            url: "https://www.youtube.com/watch?v=sewing-machine-selection",
            langue: "عربي",
            duree: "20 دقيقة",
            niveau: "مبتدئ",
            description: "دليل شامل لاختيار ماكينة الخياطة المناسبة للمبتدئين"
        },
        {
            id: 3,
            type: "فيديو",
            titre: "تقنيات الغرز الأساسية",
            url: "https://www.youtube.com/watch?v=basic-stitches-tutorial",
            langue: "عربي",
            duree: "25 دقيقة",
            niveau: "مبتدئ",
            description: "شرح مفصل للغرز الأساسية: المستقيمة، الزجزاج، والرجوع"
        },
        {
            id: 4,
            type: "فيديو",
            titre: "خياطة مشروعك الأول - جيب بسيط",
            url: "https://www.youtube.com/watch?v=first-sewing-project",
            langue: "عربي",
            duree: "30 دقيقة",
            niveau: "مبتدئ",
            description: "مشروع عملي كامل لخياطة جيب بسيط خطوة بخطوة"
        },
        {
            id: 5,
            type: "فيديو",
            titre: "تركيب السحابات بطريقة احترافية",
            url: "https://www.youtube.com/watch?v=zipper-installation-pro",
            langue: "عربي",
            duree: "18 دقيقة",
            niveau: "متوسط",
            description: "تقنيات متقدمة لتركيب أنواع مختلفة من السحابات"
        },
        {
            id: 6,
            type: "فيديو",
            titre: "عمل عراوي الأزرار المثالية",
            url: "https://www.youtube.com/watch?v=perfect-buttonholes",
            langue: "عربي",
            duree: "12 دقيقة",
            niveau: "متوسط",
            description: "كيفية عمل عراوي منتظمة ومتينة بالماكينة"
        },
        {
            id: 7,
            type: "فيديو",
            titre: "خياطة الأكمام وتركيبها",
            url: "https://www.youtube.com/watch?v=sleeve-construction",
            langue: "عربي",
            duree: "22 دقيقة",
            niveau: "متوسط",
            description: "تقنيات خياطة وتركيب الأكمام بشكل احترافي"
        },
        {
            id: 8,
            type: "فيديو",
            titre: "التعديلات والإصلاحات الأساسية",
            url: "https://www.youtube.com/watch?v=alterations-repairs",
            langue: "عربي",
            duree: "28 دقيقة",
            niveau: "متوسط",
            description: "كيفية تقصير، توسيع، وإصلاح الملابس"
        },
        {
            id: 9,
            type: "فيديو",
            titre: "خياطة فستان بسيط من الألف للياء",
            url: "https://www.youtube.com/watch?v=simple-dress-complete",
            langue: "عربي",
            duree: "45 دقيقة",
            niveau: "متقدم",
            description: "مشروع كامل لخياطة فستان بسيط مع كل التفاصيل"
        },
        {
            id: 10,
            type: "فيديو",
            titre: "التطريز اليدوي للمبتدئين",
            url: "https://www.youtube.com/watch?v=hand-embroidery-basics",
            langue: "عربي",
            duree: "35 دقيقة",
            niveau: "متوسط",
            description: "تعلم الغرز الأساسية للتطريز اليدوي وزخرفة الملابس"
        },
        {
            id: 11,
            type: "فيديو",
            titre: "الخياطة التجارية - بدء مشروعك",
            url: "https://www.youtube.com/watch?v=sewing-business-startup",
            langue: "عربي",
            duree: "40 دقيقة",
            niveau: "متقدم",
            description: "دليل كامل لبدء مشروع خياطة صغير من المنزل"
        },

        // مواقع مفيدة
        {
            id: 12,
            type: "موقع",
            titre: "باترونات مجانية للمبتدئات",
            url: "https://www.pattern-free.com/beginner-arabic",
            langue: "عربي",
            description: "مجموعة كبيرة من الباترونات المجانية لجميع المستويات",
            محتوى: "باترونات، دروس، نصائح"
        },
        {
            id: 13,
            type: "موقع",
            titre: "متجر الأقمشة والأدوات",
            url: "https://www.fabric-store-morocco.com",
            langue: "عربي",
            description: "متجر إلكتروني متخصص في أقمشة وأدوات الخياطة بالمغرب",
            محتوى: "أقمشة، أدوات، إكسسوارات"
        },
        {
            id: 14,
            type: "موقع",
            titre: "مجتمع الخياطات العربيات",
            url: "https://www.arabic-sewing-community.com",
            langue: "عربي",
            description: "منتدى للخياطات لتبادل الخبرات والنصائح",
            محتوى: "منتدى، نصائح، مشاريع مشتركة"
        },
        {
            id: 15,
            type: "موقع",
            titre: "حاسبة مقاسات الجسم",
            url: "https://www.body-measurements-calculator.com/ar",
            langue: "عربي",
            description: "أداة لحساب المقاسات وتحويل أحجام الملابس",
            محتوى: "حاسبات، جداول مقاسات"
        },

        // كتب ومراجع PDF
        {
            id: 16,
            type: "PDF",
            titre: "دليل غرز الخياطة الشامل",
            url: "https://resources.sena3timate.com/stitches-guide-ar.pdf",
            langue: "عربي",
            حجم: "15 MB",
            صفحات: "120 صفحة",
            description: "مرجع شامل لجميع أنواع الغرز مع الصور والتوضيحات"
        },
        {
            id: 17,
            type: "PDF",
            titre: "أساسيات قراءة الباترونات",
            url: "https://resources.sena3timate.com/pattern-reading-ar.pdf",
            langue: "عربي",
            حجم: "8 MB",
            صفحات: "60 صفحة",
            description: "دليل مفصل لفهم رموز وتعليمات الباترونات"
        },
        {
            id: 18,
            type: "PDF",
            titre: "جداول المقاسات العالمية",
            url: "https://resources.sena3timate.com/size-charts-ar.pdf",
            langue: "عربي",
            حجم: "3 MB",
            صفحات: "25 صفحة",
            description: "جداول شاملة لمقاسات الملابس للنساء والأطفال"
        },
        {
            id: 19,
            type: "PDF",
            titre: "دليل العناية بالأقمشة",
            url: "https://resources.sena3timate.com/fabric-care-ar.pdf",
            langue: "عربي",
            حجم: "5 MB",
            صفحات: "40 صفحة",
            description: "كيفية العناية بأنواع الأقمشة المختلفة والحفاظ عليها"
        },
        {
            id: 20,
            type: "PDF",
            titre: "مشاريع خياطة للأطفال",
            url: "https://resources.sena3timate.com/kids-projects-ar.pdf",
            langue: "عربي",
            حجم: "12 MB",
            صفحات: "80 صفحة",
            description: "مجموعة مشاريع ممتعة وآمنة للأطفال لتعلم الخياطة"
        },

        // تطبيقات مفيدة
        {
            id: 21,
            type: "تطبيق",
            titre: "مساعد المقاسات الذكي",
            url: "https://play.google.com/store/apps/smart-measurements",
            منصة: "Android/iOS",
            langue: "عربي",
            description: "تطبيق لحفظ وإدارة مقاسات العملاء مع تنبيهات المواعيد"
        },
        {
            id: 22,
            type: "تطبيق",
            titre: "حاسبة تكلفة المشاريع",
            url: "https://play.google.com/store/apps/project-cost-calculator",
            منصة: "Android/iOS",
            langue: "عربي",
            description: "حساب تكلفة المواد والوقت لتسعير المشاريع بدقة"
        },
        {
            id: 23,
            type: "تطبيق",
            titre: "دليل الأقمشة المصور",
            url: "https://play.google.com/store/apps/fabric-guide-visual",
            منصة: "Android/iOS",
            langue: "عربي",
            description: "دليل مصور لأنواع الأقمشة مع خصائص واستعمالات كل نوع"
        },

        // قنوات يوتيوب متخصصة
        {
            id: 24,
            type: "قناة يوتيوب",
            titre: "أكاديمية الخياطة العربية",
            url: "https://www.youtube.com/c/ArabicSewingAcademy",
            langue: "عربي",
            مشتركين: "250K",
            description: "قناة متخصصة في تعليم الخياطة من الصفر حتى الاحتراف"
        },
        {
            id: 25,
            type: "قناة يوتيوب",
            titre: "ست البيت الماهرة",
            url: "https://www.youtube.com/c/SkillfulHousewife",
            langue: "عربي",
            مشتركين: "180K",
            description: "نصائح عملية للخياطة والتطريز وصنع الإكسسوارات"
        },

        // مواقع متخصصة للباترونات
        {
            id: 26,
            type: "موقع",
            titre: "مكتبة الباترونات العربية",
            url: "https://www.arabic-patterns-library.com",
            langue: "عربي",
            description: "أكبر مكتبة باترونات عربية مع تحديثات أسبوعية",
            محتوى: "باترونات مدفوعة ومجانية، دروس حصرية"
        },
        {
            id: 27,
            type: "موقع",
            titre: "باترونات الثوب المغربي",
            url: "https://www.moroccan-dress-patterns.com",
            langue: "عربي",
            description: "متخصص في باترونات الملابس التراثية المغربية",
            محتوى: "قفطان، تكشيطة، جلابة، جبادور"
        },

        // أدوات تفاعلية
        {
            id: 28,
            type: "أداة",
            titre: "محاكي ماكينة الخياطة",
            url: "https://www.sewing-machine-simulator.com/ar",
            langue: "عربي",
            description: "أداة تفاعلية لتعلم استخدام ماكينة الخياطة افتراضيا",
            متطلبات: "متصفح حديث، فلاش"
        },
        {
            id: 29,
            type: "أداة",
            titre: "مصمم الباترونات الرقمي",
            url: "https://www.digital-pattern-maker.com/ar",
            langue: "عربي",
            description: "أداة لرسم وتعديل الباترونات رقمياً",
            اشتراك: "مجاني مع ميزات محدودة"
        },
        {
            id: 30,
            type: "أداة",
            titre: "حاسبة استهلاك القماش",
            url: "https://www.fabric-calculator.com/ar",
            langue: "عربي",
            description: "حساب كمية القماش المطلوبة لأي مشروع خياطة",
            ميزات: "حساب دقيق، توفير المال، تجنب الهدر"
        }
    ],

    // إضافة مشاريع متدرجة حسب المستوى
    projets_guides: [
        {
            id: 1,
            titre: "جيب تسوق بسيط",
            niveau: "مبتدئ",
            duree: "2-3 ساعات",
            difficulte: 1,
            matieres: ["قماش قطني 50x70 سم", "خيط مطابق", "مقص", "دبابيس"],
            etapes: [
                "قطع قطعتين 45x35 سم",
                "عمل حاشية للحافة العلوية",
                "وضع القطعتين وجه لوجه وخياطة الجوانب والقاع",
                "قلب الجيب وعمل التشطيبات النهائية"
            ],
            conseils: "اختر قماش متين وألوان عملية للاستعمال اليومي"
        },
        {
            id: 2,
            titre: "وسادة مزخرفة",
            niveau: "مبتدئ",
            duree: "3-4 ساعات",
            difficulte: 2,
            matieres: ["قماش للوجه 42x42 سم", "قماش للظهر 42x42 سم", "سحاب 35 سم", "حشو وسادة"],
            etapes: [
                "قطع القطع حسب المقاسات",
                "تركيب السحاب في الخلف",
                "خياطة الجوانب الثلاثة المتبقية",
                "قلب الغلاف وإدخال الحشو"
            ],
            conseils: "استعمل أقمشة قابلة للغسل وألوان تتناسب مع ديكور البيت"
        },
        {
            id: 3,
            titre: "عصابة رأس أنيقة",
            niveau: "مبتدئ",
            duree: "1-2 ساعة",
            difficulte: 1,
            matieres: ["قماش 50x8 سم", "مطاط 2 سم العرض، 40 سم الطول", "خيط"],
            etapes: [
                "خياطة القماش بالطول ليصبح أنبوب",
                "قلب الأنبوب للوجه الصحيح",
                "إدخال المطاط بدبوس أمان",
                "خياطة الطرفين معا"
            ],
            conseils: "اختر أقمشة ناعمة ومريحة للرأس"
        },
        {
            id: 4,
            titre: "مئزر مطبخ عملي",
            niveau: "متوسط",
            duree: "4-5 ساعات",
            difficulte: 3,
            matieres: ["قماش رئيسي 70x50 سم", "قماش للجيب 25x20 سم", "شريط للربط 3 متر"],
            etapes: [
                "قطع الجسم الرئيسي والجيب",
                "عمل حواشي للجيب وتركيبه",
                "تركيب الأشرطة للرقبة والوسط",
                "التشطيبات النهائية والزخرفة"
            ],
            conseils: "استعمل أقمشة مقاومة للبقع وسهلة الغسل"
        },
        {
            id: 5,
            titre: "تنورة مستقيمة كلاسيكية",
            niveau: "متوسط",
            duree: "6-8 ساعات",
            difficulte: 4,
            matieres: ["قماش حسب المقاس", "سحاب خفي 20 سم", "بطانة", "خيط", "أدوات قياس"],
            etapes: [
                "أخذ المقاسات وتحضير الباترون",
                "قطع القماش والبطانة",
                "خياطة الجوانب وتركيب السحاب",
                "تركيب البطانة والتشطيب بالحاشية"
            ],
            conseils: "ابدأ بقماش متسامح مع الأخطاء مثل القطن الممزوج"
        },
        {
            id: 6,
            titre: "قميص بسيط بأكمام",
            niveau: "متقدم",
            duree: "10-12 ساعة",
            difficulte: 5,
            matieres: ["قماش قميص حسب المقاس", "أزرار 6-8 حبات", "خيط", "تقوية للكولة"],
            etapes: [
                "تحضير وقطع جميع القطع",
                "خياطة الكتوف وتركيب الكولة",
                "تركيب الأكمام وخياطة الجوانب",
                "عمل العراوي وتركيب الأزرار"
            ],
            conseils: "خذ وقتك في كل خطوة ولا تتعجل - الدقة مهمة"
        }
    ],

    // نصائح متخصصة حسب نوع القماش
    conseils_tissues: [
        {
            type_tissu: "الحرير",
            conseils: [
                "استعمل دبابيس رفيعة جدا لتجنب ترك علامات",
                "اقطع بمقص حاد جدا لتجنب التنسيل",
                "خيط بسرعة بطيئة ومنتظمة",
                "استعمل إبرة رفيعة رقم 60-70",
                "اكوي على حرارة منخفضة مع قماش حماية"
            ],
            precautions: "تجنب الشد الزائد أثناء الخياطة"
        },
        {
            type_tissu: "الدانتيل",
            conseils: [
                "قطع القطع مع الحفاظ على النقشة متكاملة",
                "استعمل مقص حاد لتجنب تلف الخيوط",
                "خيط على ورق رقيق لتجنب تعلق الدانتيل",
                "استعمل خيط شفاف أو مطابق للون",
                "تجنب الكي المباشر"
            ],
            precautions: "احذر من تمزيق النقشة الدقيقة"
        },
        {
            type_tissu: "الجينز",
            conseils: [
                "استعمل إبر قوية رقم 100-110",
                "خيط قوي ومقاوم",
                "استعمل مطرقة صغيرة لتسطيح الخياطات السميكة",
                "اكوي الخياطات مفتوحة لتجنب السماكة",
                "غسل القماش قبل الخياطة لتجنب الانكماش"
            ],
            precautions: "لا تجبر الماكينة في الأماكن السميكة"
        },
        {
            type_tissu: "الشيفون",
            conseils: [
                "ضع ورق تحت القماش أثناء الخياطة",
                "استعمل قدم تفلون لتجنب الانزلاق",
                "خيط بخطوط طويلة نسبيا",
                "استعمل مقص حاد جدا للقطع النظيف",
                "تجنب فك الخياطات - صعب جدا"
            ],
            precautions: "القماش شفاف - انتبه للبطانة"
        },
        {
            type_tissu: "المخمل",
            conseils: [
                "قطع كل القطع في نفس اتجاه الوبر",
                "استعمل دبابيس داخل مارج الخياطة فقط",
                "لا تكوي مباشرة - استعمل منشفة",
                "خيط بضغط خفيف لتجنب ترك علامات",
                "نظف الماكينة من الوبر باستمرار"
            ],
            precautions: "الوبر يتجه في اتجاه واحد - احترم ذلك"
        },
        {
            type_tissu: "الصوف",
            conseils: [
                "تأكد من استقرار القماش قبل القطع",
                "استعمل بخار خفيف للكي",
                "انتبه لاتجاه النسيج والنقشة",
                "استعمل بطانة للقطع الحساسة",
                "احفظ القصاصات للرقع المستقبلية"
            ],
            precautions: "قد ينكمش بالحرارة والرطوبة"
        }
    ],

    // أخطاء شائعة ونصائح تجنبها
    erreurs_courantes: [
        {
            erreur: "عدم غسل القماش قبل الخياطة",
            consequence: "انكماش الثوب بعد الغسل الأول",
            solution: "اغسل القماش دائما قبل القطع للتأكد من الثبات",
            prevention: "اتبع تعليمات العناية المكتوبة على القماش"
        },
        {
            erreur: "قطع قطعة واحدة معكوسة",
            consequence: "عدم تطابق القطع أو شكل غريب",
            solution: "تأكد من اتجاه الباترون على كل قطعة",
            prevention: "ضع علامات واضحة على الباترون والقماش"
        },
        {
            erreur: "نسيان مارج الخياطة",
            consequence: "ثوب ضيق أو قصير عن المطلوب",
            solution: "أضف دائما 1-2 سم للخياطة حسب الباترون",
            prevention: "راجع الباترون قبل القطع وتأكد من الهوامش"
        },
        {
            erreur: "خياطة بدون تجربة",
            consequence: "مقاس غير مناسب وصعوبة التعديل",
            solution: "جرب دائما قبل التشطيب النهائي",
            prevention: "اتركي الثوب فضفاض قليلا للتعديلات"
        },
        {
            erreur: "استعمال إبرة خاطئة",
            consequence: "ثقوب كبيرة أو كسر الخيط أو الإبرة",
            solution: "اختر الإبرة المناسبة لنوع وسماكة القماش",
            prevention: "اقرأ دليل الماكينة وتعلم أنواع الإبر"
        },
        {
            erreur: "إهمال كي الخياطات",
            consequence: "شكل غير احترافي ومتجعد",
            solution: "اكوي كل خياطة بعد خياطتها مباشرة",
            prevention: "جهز المكواة قبل البدء واجعلها جزء من الروتين"
        }
    ],

    // معلومات تقنية متقدمة
    infos_techniques: [
        {
            sujet: "أنواع الإبر ومتى تستعمل",
            details: {
                "إبرة عالمية (Universal)": "للأقمشة العادية، أرقام 70-90",
                "إبرة الجينز (Denim)": "للأقمشة السميكة، أرقام 100-110",
                "إبرة الحرير (Silk)": "للأقمشة الرقيقة، أرقام 60-70",
                "إبرة المطاط (Stretch)": "للأقمشة المطاطة، أرقام 75-90",
                "إبرة الجلد (Leather)": "للجلد والمواد السميكة",
                "إبرة مزدوجة (Twin)": "للحواشي المزدوجة والتطريز"
            }
        },
        {
            sujet: "ضبط توتر الخيط",
            details: {
                "توتر عالي": "الخيط العلوي مشدود، الغرزة تشد القماش",
                "توتر منخفض": "خيوط فضفاضة، غرز غير منتظمة",
                "توتر متوازن": "الخيطان يلتقيان في وسط القماش",
                "اختبار التوتر": "خيط على قطعة تجريبية وافحص النتيجة",
                "ضبط تدريجي": "غير بدرجات صغيرة حتى تحصل على النتيجة المطلوبة"
            }
        },
        {
            sujet: "أنواع الأقدام وفوائدها",
            details: {
                "قدم عادية": "للخياطة العامة والغرز المستقيمة",
                "قدم السحاب": "للخياطة قريبا من السحابات",
                "قدم العراوي": "لعمل عراوي منتظمة",
                "قدم الحاشية": "للحواشي المطوية والمضبوطة",
                "قدم التطريز": "للتطريز والزخرفة",
                "قدم الترقيع": "لخياطة الرقع والأعمال الدقيقة"
            }
        }
    ],

    // مشاريع موسمية ومناسبات
    projets_saisonniers: [
        {
            saison: "الربيع",
            projets: [
                {
                    nom: "جاكيت خفيف",
                    description: "جاكيت بدون بطانة للطقس المعتدل",
                    niveau: "متقدم",
                    duree: "12-15 ساعة"
                },
                {
                    nom: "فستان صيفي",
                    description: "فستان قطني خفيف بأكمام قصيرة",
                    niveau: "متوسط",
                    duree: "8-10 ساعات"
                }
            ]
        },
        {
            saison: "الصيف",
            projets: [
                {
                    nom: "شورت مريح",
                    description: "شورت قطني للبيت والرياضة",
                    niveau: "متوسط",
                    duree: "4-6 ساعات"
                },
                {
                    nom: "قميص كتان",
                    description: "قميص فضفاض من الكتان الطبيعي",
                    niveau: "متقدم",
                    duree: "10-12 ساعة"
                }
            ]
        },
        {
            saison: "الخريف",
            projets: [
                {
                    nom: "سترة صوفية",
                    description: "سترة دافئة للطقس البارد",
                    niveau: "متقدم",
                    duree: "15-20 ساعة"
                },
                {
                    nom: "شال أنيق",
                    description: "شال من الصوف الناعم للأناقة والدفء",
                    niveau: "مبتدئ",
                    duree: "3-4 ساعات"
                }
            ]
        },
        {
            saison: "الشتاء",
            projets: [
                {
                    nom: "معطف شتوي",
                    description: "معطف مبطن للبرد القارس",
                    niveau: "محترف",
                    duree: "20-25 ساعة"
                },
                {
                    nom: "قفازات دافئة",
                    description: "قفازات من الصوف المبطن",
                    niveau: "متوسط",
                    duree: "4-5 ساعات"
                }
            ]
        },
        {
            saison: "المناسبات",
            projets: [
                {
                    nom: "فستان سهرة",
                    description: "فستان أنيق للمناسبات الخاصة",
                    niveau: "محترف",
                    duree: "18-22 ساعة"
                },
                {
                    nom: "طقم العيد للأطفال",
                    description: "ملابس احتفالية للصغار",
                    niveau: "متوسط",
                    duree: "8-10 ساعات"
                }
            ]
        }
    ]
};

// Éléments DOM
const loginContainer = document.getElementById('loginContainer');
const chatContainer = document.getElementById('chatContainer');
const loginForm = document.getElementById('loginForm');
const chatMessages = document.getElementById('chatMessages');
const chatInput = document.getElementById('chatInput');
const sendButton = document.getElementById('sendButton');

// === FONCTIONS DE TRADUCTION (DARIJA UNIQUEMENT) ===
function getText(key, replacements = {}) {
    let text = translations.darija[key] || key;
    
    Object.keys(replacements).forEach(key => {
        text = text.replace(`{${key}}`, replacements[key]);
    });
    
    return text;
}

// === INITIALISATION ===
document.addEventListener('DOMContentLoaded', function() {
    // Forcer RTL et langue arabe
    document.body.classList.add('rtl');
    document.documentElement.setAttribute('lang', 'ar');
    document.documentElement.setAttribute('dir', 'rtl');
    
    const savedUserId = localStorage.getItem('currentUserId');
    if (savedUserId) {
        currentUser = usersDatabase.users.find(u => u.id == savedUserId);
        if (currentUser) {
            showChatInterface();
            return;
        }
    }
    
    showLoginInterface();
    
    loginForm.addEventListener('submit', handleLogin);
    
    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
    
    sendButton.addEventListener('click', sendMessage);
    
    document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('dropdownMenu');
        const userProfile = event.target.closest('.user-profile');
        
        if (!userProfile && !dropdown?.contains(event.target)) {
            dropdown?.classList.remove('show');
        }
        
        if (event.target.classList.contains('modal')) {
            closeModal(event.target.id);
        }
    });
    
    console.log('🚀 Sena3timate initialisé avec police Viga');
});

// === GESTION DES UTILISATEURS MODIFIÉE ===
function showLoginInterface() {
    // Changer la classe du body pour la page de connexion
    document.body.className = 'rtl login-page';
    
    const loginContainer = document.getElementById('loginContainer');
    const chatContainer = document.getElementById('chatContainer');
    
    if (loginContainer && chatContainer) {
        loginContainer.style.display = 'flex';
        chatContainer.style.display = 'none';
        
        // Vider et réinitialiser les champs
        setTimeout(() => {
            clearLoginForm();
            hideMessages();
        }, 100);
        
        console.log('✅ Interface de connexion affichée avec footer bleu');
    } else {
        console.error('❌ Erreur: Conteneurs non trouvés');
    }
}

function showChatInterface() {
    // Changer la classe du body pour la page de chat
    document.body.className = 'rtl chat-page';
    
    const loginContainer = document.getElementById('loginContainer');
    const chatContainer = document.getElementById('chatContainer');
    
    if (loginContainer && chatContainer) {
        loginContainer.style.display = 'none';
        chatContainer.style.display = 'flex';
        
        initializeProfile();
        clearChatMessages();
        showWelcomeMessage();
        
        console.log('✅ Interface de chat affichée avec footer rose');
    } else {
        console.error('❌ Erreur: Conteneurs non trouvés');
    }
}

function handleLogin(e) {
    e.preventDefault();
    
    const phoneNumber = document.getElementById('phoneNumber').value.trim();
    const password = document.getElementById('password').value.trim();
    
    if (!phoneNumber || !password) {
        showError(getText('fill_fields'));
        return;
    }

    if (isRegistering) {
        registerUser(phoneNumber, password);
    } else {
        loginUser(phoneNumber, password);
    }
}

function loginUser(phone, password) {
    const user = usersDatabase.users.find(u => u.phone === phone && u.password === password);
    
    if (user) {
        currentUser = user;
        currentUser.derniere_activite = new Date().toISOString().split('T')[0];
        localStorage.setItem('currentUserId', user.id);
        saveUsersDatabase();
        showSuccess(getText('login_success') + ' ' + user.nom);
        
        setTimeout(() => {
            showChatInterface();
        }, 1500);
    } else {
        showError(getText('login_error'));
    }
}

function registerUser(phone, password) {
    const existingUser = usersDatabase.users.find(u => u.phone === phone);
    if (existingUser) {
        showError(getText('phone_exists'));
        return;
    }

    const newUser = {
        id: usersDatabase.users.length + 1,
        phone: phone,
        password: password,
        nom: `مستخدم ${phone.slice(-4)}`,
        date_inscription: new Date().toISOString().split('T')[0],
        progression: 0,
        niveau_atteint: getText('level_beginner'),
        derniere_activite: new Date().toISOString().split('T')[0],
        photo_profile: "",
        resultats_quiz: [],
        lecons_terminees: []
    };

    usersDatabase.users.push(newUser);
    saveUsersDatabase();
    
    showSuccess(getText('account_created'));
    
    setTimeout(() => {
        showRegister();
    }, 2000);
}

function showRegister() {
    isRegistering = !isRegistering;
    const loginBtn = document.querySelector('.login-btn');
    const registerLink = document.querySelector('.register-link');
    const subtitle = document.querySelector('.login-subtitle');
    
    if (isRegistering) {
        loginBtn.textContent = getText('create_account_btn');
        registerLink.innerHTML = `<span>${getText('already_registered')}</span> <a onclick="showRegister()">${getText('sign_in')}</a>`;
        subtitle.textContent = getText('create_subtitle');
    } else {
        loginBtn.textContent = getText('login_btn');
        registerLink.innerHTML = `<span>${getText('not_registered')}</span> <a onclick="showRegister()">${getText('create_account')}</a>`;
        subtitle.textContent = getText('subtitle');
    }
    
    document.getElementById('phoneNumber').value = '';
    document.getElementById('password').value = '';
    hideMessages();
}

function showError(message) {
    const errorDiv = document.getElementById('errorMessage');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    document.getElementById('successMessage').style.display = 'none';
}

function showSuccess(message) {
    const successDiv = document.getElementById('successMessage');
    successDiv.textContent = message;
    successDiv.style.display = 'block';
    document.getElementById('errorMessage').style.display = 'none';
}

function hideMessages() {
    document.getElementById('errorMessage').style.display = 'none';
    document.getElementById('successMessage').style.display = 'none';
}

function saveUsersDatabase() {
    localStorage.setItem('usersDatabase', JSON.stringify(usersDatabase));
}

function saveUserData() {
    const userIndex = usersDatabase.users.findIndex(u => u.id === currentUser.id);
    if (userIndex !== -1) {
        usersDatabase.users[userIndex] = currentUser;
        saveUsersDatabase();
    }
}

// === FONCTION POUR VIDER LE FORMULAIRE DE CONNEXION ===
function clearLoginForm() {
    const phoneInput = document.getElementById('phoneNumber');
    const passwordInput = document.getElementById('password');
    
    if (phoneInput) {
        phoneInput.value = '';
        phoneInput.blur();
    }
    
    if (passwordInput) {
        passwordInput.value = '';
        passwordInput.blur();
    }
    
    if (isRegistering) {
        showRegister();
    }
    
    setTimeout(() => {
        if (phoneInput) phoneInput.value = '';
        if (passwordInput) passwordInput.value = '';
    }, 100);
}

// === FONCTION POUR VIDER LES MESSAGES DE CHAT ===
function clearChatMessages() {
    const chatMessages = document.getElementById('chatMessages');
    const typingIndicator = document.getElementById('typingIndicator');
    
    if (chatMessages) {
        chatMessages.innerHTML = '';
        if (typingIndicator) {
            chatMessages.appendChild(typingIndicator);
        }
    }
    
    const chatInput = document.getElementById('chatInput');
    if (chatInput) {
        chatInput.value = '';
        chatInput.blur();
    }
}

// === GESTION DU PROFIL ===
function initializeProfile() {
    const profileName = document.getElementById('profileName');
    const profileAvatar = document.getElementById('profileAvatar');
    const profilePicturePreview = document.getElementById('profilePicturePreview');
    const usernameInput = document.getElementById('usernameInput');

    profileName.textContent = currentUser.nom;
    if (usernameInput) usernameInput.value = currentUser.nom;

    if (currentUser.photo_profile) {
        profileAvatar.src = currentUser.photo_profile;
        profileAvatar.style.display = 'block';
        if (profilePicturePreview) {
            profilePicturePreview.src = currentUser.photo_profile;
            profilePicturePreview.innerHTML = '';
        }
    } else {
        profileAvatar.src = '';
        profileAvatar.style.display = 'none';
        if (profilePicturePreview) {
            profilePicturePreview.src = '';
            profilePicturePreview.innerHTML = '<i class="fas fa-user"></i>';
        }
    }
}

function toggleDropdown() {
    const dropdown = document.getElementById('dropdownMenu');
    dropdown.classList.toggle('show');
}

function openProfileModal() {
    const modal = document.getElementById('profileModal');
    const usernameInput = document.getElementById('usernameInput');
    const profilePicturePreview = document.getElementById('profilePicturePreview');
    
    usernameInput.value = currentUser.nom;
    
    if (currentUser.photo_profile) {
        profilePicturePreview.src = currentUser.photo_profile;
        profilePicturePreview.innerHTML = '';
    } else {
        profilePicturePreview.src = '';
        profilePicturePreview.innerHTML = '<i class="fas fa-user"></i>';
    }
    
    modal.classList.add('show');
    document.getElementById('dropdownMenu').classList.remove('show');
}

function previewProfilePicture(event) {
    const file = event.target.files[0];
    const preview = document.getElementById('profilePicturePreview');
    
    if (file) {
        if (file.size > 1024 * 1024) {
            alert(getText('image_too_large'));
            return;
        }
        
        if (!file.type.startsWith('image/')) {
            alert(getText('select_valid_image'));
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.innerHTML = '';
        };
        reader.readAsDataURL(file);
    }
}

function saveProfile() {
    const usernameInput = document.getElementById('usernameInput');
    const profilePicturePreview = document.getElementById('profilePicturePreview');
    const newName = usernameInput.value.trim();
    
    if (!newName) {
        alert(getText('username_required'));
        return;
    }
    
    if (newName.length > 30) {
        alert('الاسم ماينقدرش يكون أكثر من 30 حرف');
        return;
    }
    
    currentUser.nom = newName;
    currentUser.photo_profile = profilePicturePreview.src || '';
    
    saveUserData();
    
    const profileName = document.getElementById('profileName');
    const profileAvatar = document.getElementById('profileAvatar');
    
    profileName.textContent = newName;
    
    if (currentUser.photo_profile) {
        profileAvatar.src = currentUser.photo_profile;
        profileAvatar.style.display = 'block';
    } else {
        profileAvatar.src = '';
        profileAvatar.style.display = 'none';
    }
    
    closeModal('profileModal');
    
    addBotMessage(`
        <div style="text-align: center; padding: 20px;">
            <i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success); margin-bottom: 15px;"></i>
            <h3 style="color: var(--text-primary); margin-bottom: 10px;">${getText('profile_updated')}</h3>
            <p style="color: var(--text-primary); opacity: 0.8;">${getText('profile_saved')}</p>
        </div>
    `, [
        { text: "🏠 " + getText('main_menu'), action: "welcome" }
    ]);
}

// === GESTION DES MODALES ===
function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    modal.classList.remove('show');
}

function showProgression() {
    updateProgressStats();
    const modal = document.getElementById('progressModal');
    modal.classList.add('show');
    document.getElementById('dropdownMenu').classList.remove('show');
}

function showCompletedCourses() {
    updateCompletedCoursesList();
    const modal = document.getElementById('completedCoursesModal');
    modal.classList.add('show');
    document.getElementById('dropdownMenu').classList.remove('show');
}

function updateProgressStats() {
    const totalLessons = database.lecons.length;
    const completedLessons = currentUser.lecons_terminees ? currentUser.lecons_terminees.length : 0;
    const completedQuizzes = currentUser.resultats_quiz ? currentUser.resultats_quiz.filter(r => r.score >= 70).length : 0;
    
    const averageScore = currentUser.resultats_quiz && currentUser.resultats_quiz.length > 0 ? 
        Math.round(currentUser.resultats_quiz.reduce((sum, r) => sum + r.score, 0) / currentUser.resultats_quiz.length) : 0;
    
    const progressPercent = Math.round((completedLessons / totalLessons) * 100);
    
    document.getElementById('progressPercent').textContent = progressPercent;
    document.getElementById('progressFill').style.width = progressPercent + '%';
    document.getElementById('completedQuizzes').textContent = completedQuizzes;
    document.getElementById('averageScore').textContent = averageScore;
    document.getElementById('completedLessons').textContent = completedLessons;
    document.getElementById('memberSince').textContent = currentUser.date_inscription;
    
    currentUser.progression = progressPercent;
    saveUserData();
}

function updateCompletedCoursesList() {
    const container = document.getElementById('completedCoursesList');
    const completedLessons = currentUser.lecons_terminees || [];
    
    if (completedLessons.length === 0) {
        container.innerHTML = `<p style="text-align: center; opacity: 0.7;">${getText('no_lessons_completed')}</p>`;
        document.getElementById('totalCompletedLessons').textContent = '0';
        return;
    }
    
    let content = '';
    completedLessons.forEach(lessonId => {
        const lesson = database.lecons.find(l => l.id === lessonId);
        const module = database.modules.find(m => m.id === lesson.id_module);
        
        content += `
            <div class="completed-course">
                <h4 style="color: var(--text-primary); margin-bottom: 5px;">${lesson.titre}</h4>
                <p style="color: var(--text-primary); opacity: 0.7; font-size: 0.85rem;">الوحدة: ${module.titre}</p>
                <div style="margin-top: 8px;">
                    <span style="background: var(--success); color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.75rem;">✓ مكتمل</span>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = content;
    document.getElementById('totalCompletedLessons').textContent = completedLessons.length;
}

function logout() {
    const dropdown = document.getElementById('dropdownMenu');
    if (dropdown) {
        dropdown.classList.remove('show');
    }
    
    const modal = document.getElementById('logoutModal');
    if (modal) {
        modal.classList.add('show');
    }
}

// === FONCTION DE DÉCONNEXION MODIFIÉE ===
function confirmLogout() {
    addBotMessage(`
        <div style="text-align: center; padding: 20px;">
            <h3 style="color: var(--text-primary); margin-bottom: 10px;">بسلامة ${currentUser.nom}!</h3>
            <p style="color: var(--text-primary); opacity: 0.8;">شكرا على استعمال <span style="font-family: var(--font-brand) !important; color: var(--accent-warm);">Sena3timate</span>. نشوفك قريبا باش نكملو التعلم!</p>
        </div>
    `);
    
    setTimeout(() => {
        currentUser = null;
        conversationState = 'welcome';
        currentQuiz = null;
        currentQuizAnswers = {};
        isRegistering = false;
        
        localStorage.removeItem('currentUserId');
        
        closeModal('logoutModal');
        clearLoginForm();
        clearChatMessages();
        showLoginInterface();
        hideMessages();
        
        console.log('Déconnexion réussie - footer retourné en bleu');
    }, 2000);
}

// === GESTION DU CHAT ===
function showWelcomeMessage() {
    setTimeout(() => {
        addBotMessage(`
            <div style="text-align: center; margin-bottom: 20px;">
                <h3 style="color: var(--text-primary); margin: 10px 0;">مرحبا بك ${currentUser.nom} في <span style="font-family: var(--font-brand) !important; color: var(--accent-warm);">Sena3timate</span>!</h3>
                <p style="color: var(--text-primary); opacity: 0.8; margin-bottom: 20px;">${getText('welcome_description')}</p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${currentUser.progression || 0}%"></div>
                </div>
                <p style="font-size: 0.9rem; color: var(--text-primary); opacity: 0.7; margin-top: 5px;">${getText('your_progress')} ${currentUser.progression || 0}%</p>
            </div>
        `, [
            { text: getText('see_modules'), action: "modules" },
            { text: getText('take_quiz'), action: "quiz" },
            { text: getText('see_glossary'), action: "glossaire" },
            { text: getText('see_resources'), action: "ressources" }
        ]);
    }, 500);
}

function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;

    addUserMessage(message);
    chatInput.value = '';
    
    setTimeout(() => {
        processUserMessage(message);
    }, 500);
}

function addUserMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message user';
    messageDiv.innerHTML = `
        <div class="message-content">
            ${message}
        </div>
    `;
    
    const typingIndicator = document.getElementById('typingIndicator');
    chatMessages.insertBefore(messageDiv, typingIndicator);
    scrollToBottom();
}

function addBotMessage(content, buttons = []) {
    showTypingIndicator();
    
    setTimeout(() => {
        hideTypingIndicator();
        
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message bot';
        
        let buttonsHtml = '';
        if (buttons.length > 0) {
            buttonsHtml = '<div class="message-buttons">';
            buttons.forEach(button => {
                buttonsHtml += `<button class="message-button" onclick="handleButtonClick('${button.action}')">${button.text}</button>`;
            });
            buttonsHtml += '</div>';
        }
        
        messageDiv.innerHTML = `
            <div class="message-content">
                ${content}
                ${buttonsHtml}
            </div>
        `;
        
        const typingIndicator = document.getElementById('typingIndicator');
        chatMessages.insertBefore(messageDiv, typingIndicator);
        scrollToBottom();
    }, 1000);
}

function showTypingIndicator() {
    const indicator = document.getElementById('typingIndicator');
    indicator.style.display = 'block';
    scrollToBottom();
}

function hideTypingIndicator() {
    const indicator = document.getElementById('typingIndicator');
    indicator.style.display = 'none';
}

function scrollToBottom() {
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function handleButtonClick(action) {
    const actions = action.split('_');
    
    switch(actions[0]) {
        case 'welcome':
            showWelcomeMessage();
            break;
        case 'modules':
            showModules();
            break;
        case 'lecons':
            showLessons(parseInt(actions[1]));
            break;
        case 'lesson':
            showFullLesson(parseInt(actions[1]));
            break;
        case 'next':
            if (actions[1] === 'lesson') {
                showNextLesson(parseInt(actions[2]));
            }
            break;
        case 'quiz':
            if (actions[1] === 'lesson') {
                startLessonQuiz(parseInt(actions[2]));
            } else if (actions[1] === 'module') {
                startQuiz(parseInt(actions[2]));
            } else {
                showQuizMenu();
            }
            break;
        case 'glossaire':
            showGlossaire();
            break;
        case 'ressources':
            showRessources();
            break;
        case 'aide':
            showHelp();
            break;
        default:
            processUserMessage(action);
            break;
    }
}

function processUserMessage(message) {
    const lowerMessage = message.toLowerCase();
    
    if (lowerMessage.includes('وحدة') || lowerMessage.includes('درس')) {
        showModules();
    } else if (lowerMessage.includes('اختبار')) {
        showQuizMenu();
    } else if (lowerMessage.includes('قاموس')) {
        showGlossaire();
    } else if (lowerMessage.includes('مصادر') || lowerMessage.includes('فيديو')) {
        showRessources();
    } else if (lowerMessage.includes('تقدم')) {
        showProgression();
    } else if (lowerMessage.includes('مساعدة')) {
        showHelp();
    } else if (lowerMessage.includes('حساب')) {
        openProfileModal();
    } else {
        const foundTerms = database.glossaire.filter(term => 
            lowerMessage.includes(term.terme.toLowerCase())
        );
        
        if (foundTerms.length > 0) {
            showGlossaryTerms(foundTerms);
        } else {
            addBotMessage(`
                ${getText('no_understand', {name: currentUser.nom})}
            `, [
                { text: getText('see_modules'), action: "modules" },
                { text: getText('take_quiz'), action: "quiz" },
                { text: getText('see_glossary'), action: "glossaire" },
                { text: getText('see_resources'), action: "ressources" },
                { text: getText('help_question'), action: "aide" }
            ]);
        }
    }
}

// === GESTION DES MODULES ET LEÇONS ===
function showModules() {
    let modulesList = `<h3 style="color: var(--text-primary); margin-bottom: 15px;"><i class="fas fa-graduation-cap"></i> ${getText('modules_title')}</h3>`;
    
    database.modules.forEach(module => {
        const lessonsCount = database.lecons.filter(l => l.id_module === module.id).length;
        modulesList += `
            <div style="background: #ffffff; border: 1px solid #e5e3de; border-radius: 8px; padding: 15px; margin: 10px 0; border-left: 4px solid var(--accent-warm); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);">
                <h4 style="color: var(--text-primary); margin-bottom: 5px;">${module.titre}</h4>
                <p style="color: var(--text-primary); opacity: 0.8; font-size: 0.9rem; margin-bottom: 8px;">${module.description}</p>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="background: var(--accent-warm); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">${module.niveau}</span>
                    <span style="color: var(--text-primary); opacity: 0.6; font-size: 0.8rem;">${lessonsCount} ${getText('lessons')}</span>
                </div>
            </div>
        `;
    });

    addBotMessage(modulesList, [
        { text: `📖 الوحدة 1`, action: "lecons_1" },
        { text: `📖 الوحدة 2`, action: "lecons_2" },
        { text: `📖 الوحدة 3`, action: "lecons_3" },
        { text: `📖 الوحدة 4`, action: "lecons_4" },
        { text: `📖 الوحدة 5`, action: "lecons_5" },
        { text: `📖 الوحدة 6`, action: "lecons_6" },
        { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
    ]);
}

function showLessons(moduleId) {
    const module = database.modules.find(m => m.id === moduleId);
    const lessons = database.lecons.filter(l => l.id_module === moduleId);
    
    let lessonsList = `<h3 style="color: var(--text-primary); margin-bottom: 15px;"><i class="fas fa-book-open"></i> ${module.titre}</h3>`;
    lessonsList += `<p style="color: var(--text-primary); opacity: 0.8; margin-bottom: 20px;">${module.description}</p>`;
    
    lessons.forEach((lesson, index) => {
        const isCompleted = currentUser.lecons_terminees && currentUser.lecons_terminees.includes(lesson.id);
        const completedIcon = isCompleted ? '✅' : '';
        
        lessonsList += `
            <div style="background: #ffffff; border: 1px solid #e5e3de; border-radius: 8px; padding: 15px; margin: 10px 0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);">
                <h4 style="color: var(--text-primary); margin-bottom: 10px;">
                    <span style="background: var(--accent-warm); color: white; width: 25px; height: 25px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 0.8rem;">${index + 1}</span>
                    ${lesson.titre} ${completedIcon}
                </h4>
                <p style="color: var(--text-primary); opacity: 0.8; font-size: 0.9rem; line-height: 1.5;">${lesson.contenu.substring(0, 150)}...</p>
                <div style="margin-top: 10px;">
                    <button onclick="showFullLesson(${lesson.id})" style="background: var(--btn-primary); color: white; border: none; padding: 8px 15px; border-radius: 12px; cursor: pointer; font-size: 0.9rem; margin-right: 10px; font-family: var(--font-main);">${getText('read_lesson')}</button>
                    ${lesson.lien_media ? `<button onclick="showVideo('${lesson.lien_media}')" style="background: var(--success); color: white; border: none; padding: 8px 15px; border-radius: 12px; cursor: pointer; font-size: 0.9rem; font-family: var(--font-main);">🎥 ${getText('video')}</button>` : ''}
                </div>
            </div>
        `;
    });

    addBotMessage(lessonsList, [
        { text: `📚 ${getText('back_to_modules')}`, action: "modules" },
        { text: `🎯 ${getText('module_quiz')}`, action: `quiz_module_${moduleId}` },
        { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
    ]);
}

function showFullLesson(lessonId) {
    const lesson = database.lecons.find(l => l.id === lessonId);
    const module = database.modules.find(m => m.id === lesson.id_module);
    
    let lessonContent = `
        <div style="background: #ffffff; border: 1px solid #e5e3de; border-radius: 12px; padding: 20px;">
            <div style="background: var(--accent-warm); color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin: 0;"><i class="fas fa-book-open"></i> ${lesson.titre}</h3>
                <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9rem;">${getText('modules_title')}: ${module.titre}</p>
            </div>
            <div style="line-height: 1.7; color: var(--text-primary);">
                ${lesson.contenu}
            </div>
        </div>
    `;

    if (lesson.lien_media) {
        lessonContent += `
            <div class="video-container" style="margin-top: 20px;">
                <div class="video-thumbnail" onclick="showVideo('${lesson.lien_media}')">
                    <i class="fas fa-play"></i>
                </div>
                <p style="text-align: center; margin-top: 10px; color: var(--text-primary); opacity: 0.8; font-size: 0.9rem;">${getText('click_video')}</p>
            </div>
        `;
    }

    if (!currentUser.lecons_terminees) {
        currentUser.lecons_terminees = [];
    }
    if (!currentUser.lecons_terminees.includes(lessonId)) {
        currentUser.lecons_terminees.push(lessonId);
        saveUserData();
        updateProgress();
    }

    const nextLessonId = getNextLessonId(lessonId);
    const buttons = [];
    
    const lessonQuiz = database.quiz.find(q => q.id_lecon === lessonId);
    if (lessonQuiz) {
        buttons.push({ text: `🎯 ${getText('lesson_quiz')}`, action: `quiz_lesson_${lessonId}` });
    }
    
    if (nextLessonId) {
        buttons.push({ text: `➡️ ${getText('next_lesson')}`, action: `lesson_${nextLessonId}` });
    }
    
    buttons.push({ text: `📚 ${getText('back_to_module')}`, action: `lecons_${lesson.id_module}` });
    buttons.push({ text: `🏠 ${getText('main_menu')}`, action: "welcome" });

    addBotMessage(lessonContent, buttons);
}

function getNextLessonId(currentLessonId) {
    const currentLesson = database.lecons.find(l => l.id === currentLessonId);
    const moduleLessons = database.lecons.filter(l => l.id_module === currentLesson.id_module);
    const currentIndex = moduleLessons.findIndex(l => l.id === currentLessonId);
    
    if (currentIndex < moduleLessons.length - 1) {
        return moduleLessons[currentIndex + 1].id;
    }
    return null;
}

function showNextLesson(currentLessonId) {
    const nextLessonId = getNextLessonId(currentLessonId);
    if (nextLessonId) {
        showFullLesson(nextLessonId);
    } else {
        const currentLesson = database.lecons.find(l => l.id === currentLessonId);
        const module = database.modules.find(m => m.id === currentLesson.id_module);
        
        addBotMessage(`
            <div style="text-align: center; padding: 20px;">
                <i class="fas fa-trophy" style="color: var(--accent-warm); font-size: 2rem; margin-bottom: 15px;"></i>
                <h3 style="color: var(--text-primary); margin-bottom: 10px;">${getText('congratulations_module')}</h3>
                <p style="color: var(--text-primary); opacity: 0.8;">الوحدة: ${module.titre}</p>
            </div>
        `, [
            { text: `🎯 ${getText('module_quiz')}`, action: `quiz_module_${currentLesson.id_module}` },
            { text: `📚 ${getText('back_to_modules')}`, action: "modules" },
            { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
        ]);
    }
}

function updateProgress() {
    const totalLessons = database.lecons.length;
    const completedLessons = currentUser.lecons_terminees ? currentUser.lecons_terminees.length : 0;
    const progressPercent = Math.round((completedLessons / totalLessons) * 100);
    
    currentUser.progression = progressPercent;
    
    if (progressPercent >= 80) {
        currentUser.niveau_atteint = getText('level_advanced');
    } else if (progressPercent >= 40) {
        currentUser.niveau_atteint = getText('level_intermediate');
    } else {
        currentUser.niveau_atteint = getText('level_beginner');
    }
    
    const profileLevel = document.querySelector('.profile-level');
    if (profileLevel) {
        profileLevel.textContent = currentUser.niveau_atteint;
    }
    
    saveUserData();
}

// === GESTION DES QUIZ ===
function showQuizMenu() {
    addBotMessage(`
        <h3 style="color: var(--text-primary); margin-bottom: 15px;"><i class="fas fa-brain"></i> ${getText('test_knowledge')}</h3>
        <p style="color: var(--text-primary); opacity: 0.8; margin-bottom: 20px;">${getText('choose_quiz')}</p>
        <p style="text-align: center; color: var(--text-primary); opacity: 0.6;">${getText('feature_coming')}</p>
    `, [
        { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
    ]);
}

function startQuiz(moduleId) {
    const moduleQuizzes = database.quiz.filter(quiz => {
        const lesson = database.lecons.find(l => l.id === quiz.id_lecon);
        return lesson.id_module == moduleId;
    });

    if (moduleQuizzes.length === 0) {
        addBotMessage(getText('no_quiz_module'), [
            { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
        ]);
        return;
    }

    currentQuiz = moduleQuizzes[0];
    currentQuizAnswers = {};
    showQuizQuestion(currentQuiz);
}

function startLessonQuiz(lessonId) {
    const lessonQuiz = database.quiz.find(q => q.id_lecon === lessonId);
    
    if (!lessonQuiz) {
        addBotMessage(getText('no_quiz_lesson'), [
            { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
        ]);
        return;
    }

    currentQuiz = lessonQuiz;
    currentQuizAnswers = {};
    showQuizQuestion(currentQuiz);
}

function showQuizQuestion(quiz) {
    const options = quiz.options.split(';');
    
    let quizContent = `
        <div class="quiz-container">
            <h3 style="color: var(--text-primary); margin-bottom: 15px;"><i class="fas fa-question-circle"></i> ${getText('quiz_question')}</h3>
            <div class="quiz-question">${quiz.question}</div>
            <div id="quiz-options-${quiz.id}">
    `;

    options.forEach((option, index) => {
        quizContent += `
            <div class="quiz-option" onclick="selectQuizOption(${quiz.id}, '${option}', ${index})">
                ${option}
            </div>
        `;
    });

    quizContent += `
            </div>
            <button onclick="submitQuizAnswer(${quiz.id})" style="background: var(--btn-primary); color: white; border: none; padding: 12px 25px; border-radius: 16px; cursor: pointer; font-size: 1rem; margin-top: 15px; width: 100%; font-family: var(--font-main);">${getText('validate_answer')}</button>
        </div>
    `;

    addBotMessage(quizContent);
}

function selectQuizOption(quizId, option, index) {
    currentQuizAnswers[quizId] = option;
    
    const optionsContainer = document.getElementById(`quiz-options-${quizId}`);
    const options = optionsContainer.querySelectorAll('.quiz-option');
    
    options.forEach(opt => opt.classList.remove('selected'));
    options[index].classList.add('selected');
}

function submitQuizAnswer(quizId) {
    const quiz = database.quiz.find(q => q.id === quizId);
    const userAnswer = currentQuizAnswers[quizId];
    
    if (!userAnswer) {
        alert(getText('select_answer'));
        return;
    }

    const isCorrect = userAnswer === quiz.bonne_reponse;
    const optionsContainer = document.getElementById(`quiz-options-${quizId}`);
    const options = optionsContainer.querySelectorAll('.quiz-option');

    options.forEach(option => {
        if (option.textContent.trim() === quiz.bonne_reponse) {
            option.classList.add('correct');
        } else if (option.textContent.trim() === userAnswer && !isCorrect) {
            option.classList.add('incorrect');
        }
    });

    setTimeout(() => {
        let resultMessage = `
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 3rem; margin-bottom: 15px;">
                    ${isCorrect ? '🎉' : '📚'}
                </div>
                <h3 style="color: ${isCorrect ? 'var(--success)' : 'var(--error)'}; margin-bottom: 10px;">
                    ${isCorrect ? getText('excellent_answer') : getText('almost')}
                </h3>
                <div style="background: #ffffff; border: 1px solid #e5e3de; border-radius: 8px; padding: 15px; margin: 15px 0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);">
                    <p style="color: var(--text-primary); margin-bottom: 10px;">${getText('explanation')}</p>
                    <p style="color: var(--text-primary); opacity: 0.8; line-height: 1.5;">${quiz.explication}</p>
                </div>
            </div>
        `;

        addBotMessage(resultMessage, [
            { text: `🎯 ${getText('new_quiz')}`, action: "quiz" },
            { text: `📚 ${getText('back_to_modules')}`, action: "modules" },
            { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
        ]);

        const score = isCorrect ? 100 : 0;
        if (!currentUser.resultats_quiz) {
            currentUser.resultats_quiz = [];
        }
        
        currentUser.resultats_quiz.push({
            id: currentUser.resultats_quiz.length + 1,
            id_quiz: quizId,
            score: score,
            date_tentative: new Date().toISOString().split('T')[0],
            nombre_essais: 1
        });

        if (isCorrect) {
            updateProgress();
        }
        
        saveUserData();
    }, 1000);
}

// === GESTION DU GLOSSAIRE ===
function showGlossaire() {
    let glossaireContent = `
        <h3 style="color: var(--text-primary); margin-bottom: 15px;"><i class="fas fa-book"></i> ${getText('sewing_glossary')}</h3>
        <p style="color: var(--text-primary); opacity: 0.8; margin-bottom: 20px;">${getText('all_definitions')}</p>
    `;

    database.glossaire.forEach(terme => {
        glossaireContent += `
            <div class="glossary-term">
                <div class="glossary-term-title">${terme.terme}</div>
                <div class="glossary-term-definition">${terme.definition}</div>
                <div style="font-style: italic; margin-top: 5px; color: var(--text-primary); opacity: 0.7; font-size: 0.85rem;">
                    ${getText('example')} ${terme.exemple}
                </div>
            </div>
        `;
    });

    addBotMessage(glossaireContent, [
        { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
    ]);
}

function showGlossaryTerms(terms) {
    let content = `
        <h3 style="color: var(--text-primary); margin-bottom: 15px;"><i class="fas fa-search"></i> ${getText('found_terms')}</h3>
    `;

    terms.forEach(terme => {
        content += `
            <div class="glossary-term">
                <div class="glossary-term-title">${terme.terme}</div>
                <div class="glossary-term-definition">${terme.definition}</div>
                <div style="font-style: italic; margin-top: 5px; color: var(--text-primary); opacity: 0.7; font-size: 0.85rem;">
                    ${getText('example')} ${terme.exemple}
                </div>
            </div>
        `;
    });

    addBotMessage(content, [
        { text: `📖 ${getText('see_all_glossary')}`, action: "glossaire" },
        { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
    ]);
}

// === GESTION DES RESSOURCES (SUITE) ===
function showRessources() {
    let ressourcesContent = `
        <h3 style="color: var(--text-primary); margin-bottom: 15px;"><i class="fas fa-video"></i> ${getText('additional_resources')}</h3>
        <p style="color: var(--text-primary); opacity: 0.8; margin-bottom: 20px;">${getText('additional_resources_desc')}</p>
    `;

    database.ressources.forEach(ressource => {
        let icon = '📄';
        if (ressource.type === 'فيديو') icon = '🎥';
        else if (ressource.type === 'موقع') icon = '🌐';
        
        ressourcesContent += `
            <div style="background: #ffffff; border: 1px solid #e5e3de; border-radius: 8px; padding: 15px; margin: 10px 0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);">
                <h4 style="color: var(--text-primary); margin-bottom: 8px;">${icon} ${ressource.titre}</h4>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="background: var(--btn-secondary); color: var(--text-primary); padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">${ressource.type}</span>
                    <button onclick="openResource('${ressource.url}')" style="background: var(--btn-primary); color: white; border: none; padding: 8px 15px; border-radius: 12px; cursor: pointer; font-size: 0.9rem; font-family: var(--font-main) !important;">${getText('consult')}</button>
                </div>
                <p style="color: var(--text-primary); opacity: 0.7; font-size: 0.8rem; margin-top: 8px;">${getText('resource_new_tab')}</p>
            </div>
        `;
    });

    addBotMessage(ressourcesContent, [
        { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
    ]);
}

function openResource(url) {
    addBotMessage(`
        <div style="text-align: center; padding: 20px;">
            <i class="fas fa-external-link-alt" style="color: var(--accent-warm); font-size: 2rem; margin-bottom: 15px;"></i>
            <h3 style="color: var(--text-primary); margin-bottom: 10px;">${getText('access_resource')}</h3>
            <p style="color: var(--text-primary); opacity: 0.8;">${getText('resource_new_tab')}</p>
        </div>
    `, [
        { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
    ]);
    
    setTimeout(() => {
        window.open(url, '_blank');
    }, 1000);
}

// === GESTION DES VIDÉOS ===
function showVideo(url) {
    const videoModal = document.getElementById('videoModal');
    const videoContainer = document.getElementById('videoContainer');
    
    // Convertir l'URL YouTube pour l'embed
    let embedUrl = url;
    if (url.includes('youtube.com/watch?v=')) {
        const videoId = url.split('v=')[1].split('&')[0];
        embedUrl = `https://www.youtube.com/embed/${videoId}`;
    } else if (url.includes('youtu.be/')) {
        const videoId = url.split('youtu.be/')[1];
        embedUrl = `https://www.youtube.com/embed/${videoId}`;
    }
    
    videoContainer.innerHTML = `
        <iframe 
            width="100%" 
            height="400" 
            src="${embedUrl}?autoplay=1" 
            frameborder="0" 
            allowfullscreen
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
        </iframe>
    `;
    
    videoModal.classList.add('show');
}

function closeVideoModal() {
    const videoModal = document.getElementById('videoModal');
    const videoContainer = document.getElementById('videoContainer');
    videoContainer.innerHTML = '';
    videoModal.classList.remove('show');
}

// === GESTION DE L'AIDE ===
function showHelp() {
    const helpContent = `
        <h3 style="color: var(--text-primary); margin-bottom: 15px;"><i class="fas fa-question-circle"></i> ${getText('how_to_use')}</h3>
        
        <div style="background: #ffffff; border: 1px solid #e5e3de; border-radius: 8px; padding: 15px; margin: 15px 0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);">
            <h4 style="color: var(--text-primary); margin-bottom: 10px;"><i class="fas fa-compass"></i> ${getText('navigation')}</h4>
            <p style="color: var(--text-primary); opacity: 0.8; line-height: 1.5;">${getText('use_buttons')}</p>
        </div>
        
        <div style="background: #ffffff; border: 1px solid #e5e3de; border-radius: 8px; padding: 15px; margin: 15px 0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);">
            <h4 style="color: var(--text-primary); margin-bottom: 10px;"><i class="fas fa-graduation-cap"></i> ${getText('learning')}</h4>
            <p style="color: var(--text-primary); opacity: 0.8; line-height: 1.5;">${getText('start_modules')}</p>
        </div>
        
        <div style="background: #ffffff; border: 1px solid #e5e3de; border-radius: 8px; padding: 15px; margin: 15px 0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);">
            <h4 style="color: var(--text-primary); margin-bottom: 10px;"><i class="fas fa-user-cog"></i> ${getText('customization')}</h4>
            <p style="color: var(--text-primary); opacity: 0.8; line-height: 1.5;">${getText('click_profile')}</p>
        </div>
        
        <div style="background: #ffffff; border: 1px solid #e5e3de; border-radius: 8px; padding: 15px; margin: 15px 0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);">
            <h4 style="color: var(--text-primary); margin-bottom: 10px;"><i class="fas fa-lightbulb"></i> ${getText('tips')}</h4>
            <ul style="color: var(--text-primary); opacity: 0.8; line-height: 1.6; margin: 0; padding-right: 20px;">
                <li>${getText('tip_1')}</li>
                <li>${getText('tip_2')}</li>
                <li>${getText('tip_3')}</li>
                <li>${getText('tip_4')}</li>
                <li>${getText('tip_5')}</li>
            </ul>
        </div>
    `;

    addBotMessage(helpContent, [
        { text: `🚀 ${getText('start_learning')}`, action: "modules" },
        { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
    ]);
}

// === FONCTIONS UTILITAIRES ===
function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}

function formatDate(dateString) {
    const date = new Date(dateString);
    const options = { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    };
    
    return date.toLocaleDateString('ar-MA', options);
}

function generateUniqueId() {
    return Date.now() + Math.random().toString(36).substr(2, 9);
}

// === FONCTIONS DE VALIDATION ===
function validatePhoneNumber(phone) {
    const phoneRegex = /^(0|\+212)[5-7][0-9]{8}$/;
    return phoneRegex.test(phone.replace(/\s/g, ''));
}

function validatePassword(password) {
    return password.length >= 6;
}

function sanitizeInput(input) {
    const div = document.createElement('div');
    div.textContent = input;
    return div.innerHTML;
}

// === FONCTIONS D'EXPORT/IMPORT DE DONNÉES ===
function exportUserData() {
    const dataToExport = {
        user: currentUser,
        exportDate: new Date().toISOString(),
        version: "1.0"
    };
    
    const dataStr = JSON.stringify(dataToExport, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `sena3timate_${currentUser.nom}_${new Date().toISOString().split('T')[0]}.json`;
    link.click();
}

function importUserData(file) {
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const importedData = JSON.parse(e.target.result);
            if (importedData.user && importedData.version) {
                currentUser = importedData.user;
                saveUserData();
                initializeProfile();
                addBotMessage(`
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-check-circle" style="color: var(--success); font-size: 2rem; margin-bottom: 15px;"></i>
                        <h3 style="color: var(--text-primary); margin-bottom: 10px;">تم استيراد البيانات!</h3>
                        <p style="color: var(--text-primary); opacity: 0.8;">تم استعادة بياناتك بنجاح.</p>
                    </div>
                `, [
                    { text: `🏠 ${getText('main_menu')}`, action: "welcome" }
                ]);
            }
        } catch (error) {
            console.error('خطأ في الاستيراد:', error);
            alert('خطأ في استيراد البيانات');
        }
    };
    reader.readAsText(file);
}

// === FONCTIONS DE NOTIFICATION ===
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--error)' : 'var(--accent-warm)'};
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        font-size: 0.9rem;
        z-index: 3000;
        animation: slideInRight 0.3s ease, fadeOut 0.3s ease 3s forwards;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        max-width: 300px;
    `;
    
    notification.innerHTML = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 4000);
}

// === FONCTIONS DE RECHERCHE AVANCÉE ===
function searchContent(query) {
    const results = {
        lessons: [],
        modules: [],
        glossary: [],
        quiz: []
    };
    
    const searchTerm = query.toLowerCase();
    
    // Recherche dans les leçons
    database.lecons.forEach(lesson => {
        if (lesson.titre.toLowerCase().includes(searchTerm) || 
            lesson.contenu.toLowerCase().includes(searchTerm)) {
            results.lessons.push(lesson);
        }
    });
    
    // Recherche dans les modules
    database.modules.forEach(module => {
        if (module.titre.toLowerCase().includes(searchTerm) || 
            module.description.toLowerCase().includes(searchTerm)) {
            results.modules.push(module);
        }
    });
    
    // Recherche dans le glossaire
    database.glossaire.forEach(term => {
        if (term.terme.toLowerCase().includes(searchTerm) || 
            term.definition.toLowerCase().includes(searchTerm)) {
            results.glossary.push(term);
        }
    });
    
    // Recherche dans les quiz
    database.quiz.forEach(quiz => {
        if (quiz.question.toLowerCase().includes(searchTerm)) {
            results.quiz.push(quiz);
        }
    });
    
    return results;
}

// === FONCTIONS DE STATISTIQUES AVANCÉES ===
function calculateDetailedStats() {
    const stats = {
        totalTimeSpent: 0,
        averageSessionTime: 0,
        strongestTopics: [],
        weakestTopics: [],
        learningStreak: 0,
        recommendedNext: []
    };
    
    // Calcul des statistiques basées sur les données utilisateur
    if (currentUser.resultats_quiz && currentUser.resultats_quiz.length > 0) {
        const quizResults = currentUser.resultats_quiz;
        
        // Grouper par module pour identifier les forces/faiblesses
        const modulePerformance = {};
        
        quizResults.forEach(result => {
            const quiz = database.quiz.find(q => q.id === result.id_quiz);
            if (quiz) {
                const lesson = database.lecons.find(l => l.id === quiz.id_lecon);
                if (lesson) {
                    const moduleId = lesson.id_module;
                    if (!modulePerformance[moduleId]) {
                        modulePerformance[moduleId] = {
                            scores: [],
                            moduleName: database.modules.find(m => m.id === moduleId)?.titre
                        };
                    }
                    modulePerformance[moduleId].scores.push(result.score);
                }
            }
        });
        
        // Calculer les moyennes par module
        Object.keys(modulePerformance).forEach(moduleId => {
            const scores = modulePerformance[moduleId].scores;
            const average = scores.reduce((sum, score) => sum + score, 0) / scores.length;
            modulePerformance[moduleId].average = average;
        });
        
        // Identifier les points forts et faibles
        const sortedModules = Object.entries(modulePerformance)
            .sort(([,a], [,b]) => b.average - a.average);
        
        stats.strongestTopics = sortedModules.slice(0, 2).map(([id, data]) => data.moduleName);
        stats.weakestTopics = sortedModules.slice(-2).map(([id, data]) => data.moduleName);
    }
    
    return stats;
}

// === FONCTIONS POUR DIFFÉRENCIER LES COULEURS DU FOOTER ===
function showLoginInterface() {
    // Changer la classe du body pour la page de connexion
    document.body.className = 'rtl login-page';
    
    const loginContainer = document.getElementById('loginContainer');
    const chatContainer = document.getElementById('chatContainer');
    
    if (loginContainer && chatContainer) {
        loginContainer.style.display = 'flex';
        chatContainer.style.display = 'none';
        
        // Vider et réinitialiser les champs
        setTimeout(() => {
            clearLoginForm();
            hideMessages();
        }, 100);
        
        console.log('✅ Interface de connexion affichée avec footer bleu');
    } else {
        console.error('❌ Erreur: Conteneurs non trouvés');
    }
}

function showChatInterface() {
    // Changer la classe du body pour la page de chat
    document.body.className = 'rtl chat-page';
    
    const loginContainer = document.getElementById('loginContainer');
    const chatContainer = document.getElementById('chatContainer');
    
    if (loginContainer && chatContainer) {
        loginContainer.style.display = 'none';
        chatContainer.style.display = 'flex';
        
        initializeProfile();
        clearChatMessages();
        showWelcomeMessage();
        
        console.log('✅ Interface de chat affichée avec footer rose');
    } else {
        console.error('❌ Erreur: Conteneurs non trouvés');
    }
}

// === INITIALISATION DES EVENT LISTENERS SUPPLÉMENTAIRES ===
function initializeAdditionalEventListeners() {
    // Raccourcis clavier
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 'h':
                    e.preventDefault();
                    showHelp();
                    break;
                case 'm':
                    e.preventDefault();
                    showModules();
                    break;
                case 'q':
                    e.preventDefault();
                    showQuizMenu();
                    break;
                case 'g':
                    e.preventDefault();
                    showGlossaire();
                    break;
            }
        }
        
        // Échapper pour fermer les modales
        if (e.key === 'Escape') {
            document.querySelectorAll('.modal.show').forEach(modal => {
                modal.classList.remove('show');
            });
        }
    });
    
    // Détection d'inactivité
    let inactivityTimer;
    function resetInactivityTimer() {
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(() => {
            if (currentUser && chatContainer.style.display !== 'none') {
                showNotification('راك ماكتحركش. بغيتي تكمل الجلسة ديالك؟');
            }
        }, 600000); // 10 minutes
    }
    
    document.addEventListener('click', resetInactivityTimer);
    document.addEventListener('keypress', resetInactivityTimer);
    document.addEventListener('scroll', resetInactivityTimer);
    
    resetInactivityTimer();
}

// === FONCTION D'INITIALISATION FINALE ===
function initializeApp() {
    // Vérifier la compatibilité du navigateur
    if (!localStorage || !JSON) {
        alert('المتصفح ديالك ماكيدعمش هاد التطبيق.');
        return;
    }
    
    // Initialiser les event listeners supplémentaires
    initializeAdditionalEventListeners();
    
    // Charger les préférences utilisateur
    loadUserPreferences();
    
    // Initialiser les raccourcis
    showNotification('استعمل Ctrl+H للمساعدة، Ctrl+M للوحدات', 'info');
}

function loadUserPreferences() {
    const preferences = JSON.parse(localStorage.getItem('userPreferences')) || {};
    
    // Appliquer les préférences sauvegardées
    if (preferences.theme) {
        document.body.classList.add(preferences.theme);
    }
    
    if (preferences.fontSize) {
        document.documentElement.style.setProperty('--font-size-base', preferences.fontSize);
    }
}

// === GESTION DES ERREURS GLOBALES ===
window.addEventListener('error', function(e) {
    console.error('خطأ في JavaScript:', e.error);
    showNotification('وقع خطأ. عاود تحميل الصفحة.', 'error');
});

// === FONCTION DE NETTOYAGE ===
window.addEventListener('beforeunload', function() {
    if (currentUser) {
        currentUser.derniere_activite = new Date().toISOString();
        saveUserData();
    }
});

// === FONCTIONS DE DEBUG (à retirer en production) ===
function debugInfo() {
    console.log('Current User:', currentUser);
    console.log('Current Language:', currentLanguage);
    console.log('Users Database:', usersDatabase);
    console.log('Conversation State:', conversationState);
}

// Rendre debugInfo disponible globalement (uniquement pour le développement)
window.debugInfo = debugInfo;

// === FONCTION POUR TESTER LES ANIMATIONS CSS ===
function testAnimations() {
    document.addEventListener('keydown', function(e) {
        if (e.key === 'F12') {
            document.body.classList.add('debug-mode');
            console.log('Mode debug activé - Appuyez sur F11 pour tester les animations');
        }
        
        if (e.key === 'F11') {
            e.preventDefault();
            const elements = document.querySelectorAll('.message, .modal, .login-box');
            elements.forEach(el => {
                el.style.animation = 'none';
                setTimeout(() => {
                    el.style.animation = '';
                }, 10);
            });
        }
    });
}

// === FONCTION DE SAUVEGARDE AUTOMATIQUE ===
function setupAutoSave() {
    if (currentUser) {
        setInterval(() => {
            saveUserData();
            console.log('💾 Sauvegarde automatique effectuée');
        }, 60000); // Toutes les minutes
    }
}

// === FONCTION DE DÉTECTION DE LA TAILLE D'ÉCRAN ===
function detectScreenSize() {
    function updateScreenInfo() {
        const screenWidth = window.innerWidth;
        let screenType = 'desktop';
        
        if (screenWidth <= 768) {
            screenType = 'mobile';
            document.body.classList.add('mobile-view');
            document.body.classList.remove('tablet-view', 'desktop-view');
        } else if (screenWidth <= 1024) {
            screenType = 'tablet';
            document.body.classList.add('tablet-view');
            document.body.classList.remove('mobile-view', 'desktop-view');
        } else {
            screenType = 'desktop';
            document.body.classList.add('desktop-view');
            document.body.classList.remove('mobile-view', 'tablet-view');
        }
        
        console.log(`📱 Écran détecté: ${screenType} (${screenWidth}px)`);
    }
    
    updateScreenInfo();
    window.addEventListener('resize', updateScreenInfo);
}

// === FONCTION DE PERFORMANCE ===
function monitorPerformance() {
    if ('performance' in window) {
        const timing = performance.timing;
        const loadTime = timing.loadEventEnd - timing.navigationStart;
        console.log(`⚡ Temps de chargement: ${loadTime}ms`);
        
        // Surveiller les interactions
        let interactionCount = 0;
        document.addEventListener('click', () => {
            interactionCount++;
            if (interactionCount % 10 === 0) {
                console.log(`👆 Interactions utilisateur: ${interactionCount}`);
            }
        });
    }
}

// === APPEL D'INITIALISATION SUPPLÉMENTAIRE ===
setTimeout(() => {
    initializeApp();
    testAnimations();
    detectScreenSize();
    monitorPerformance();
    
    if (currentUser) {
        setupAutoSave();
    }
}, 1000);

// === LOG DE CONFIRMATION FINAL ===
console.log('🚀 Sena3timate JavaScript تم تحميله بالكامل بنجاح - الإصدار العربي مع Viga font et footer différencié!');
console.log('🎨 Footer: Bleu sur page de connexion, Rose sur page de chat');
console.log('⌨️ Raccourcis: Ctrl+H (aide), Ctrl+M (modules), Ctrl+Q (quiz), Ctrl+G (glossaire)');
